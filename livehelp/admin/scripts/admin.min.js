var service="../xml/WebService.php",session="",operator={},settings={};$.preloadImages=function(){for(var a=0;a<arguments.length;a++){$("<img>").attr("src",arguments[a]);
}};var visitorsGrid,visitorsColumns,visitors,selectedVisitor=false;function updateVisitorsGrid(){var e,d=$('.menu a[data-type="home"].selectedMenu').length,b={enableCellNavigation:true,enableColumnReorder:true,multiColumnSort:true,multiSelect:false};
if(session.length>0){var a=service+"?Visitors",c="Session="+session+"&Action=&Request=&Record=0&Total=25&Version=4.0&Format=json";$.ajax({url:a,data:c,type:"POST",success:function(g){if(g.Visitors!==null&&g.Visitors!==undefined&&g.Visitors.Visitor!==undefined){visitors=g.Visitors.Visitor;
if(g.Visitors.TotalVisitors!==undefined){updateTotal($("#visitortotal"),g.Visitors.TotalVisitors);}var h=new Slick.Data.GroupItemMetadataProvider();e=new Slick.Data.DataView({groupItemMetadataProvider:h});
if(visitorsGrid!==undefined){visitorsColumns=visitorsGrid.getColumns();}else{visitorsColumns=[{id:"browser",name:"",field:"UserAgent",width:30,resizable:false,formatter:Slick.Formatters.Browser},{id:"hostname",name:"Hostname / IP Address",field:"Hostname",width:200,sortable:true,formatter:Slick.Formatters.Hostname},{id:"status",name:"Status",field:"Active",sortable:true,formatter:Slick.Formatters.Status},{id:"location",name:"Location",field:"Country",width:150,sortable:true,formatter:Slick.Formatters.Location},{id:"pages",name:"# Pages",field:"PagePath",width:30,sortable:true,formatter:Slick.Formatters.Pages},{id:"page",name:"Current Page",field:"CurrentPage",width:290,sortable:true},{id:"referrer",name:"Referrer",field:"Referrer",width:225,sortable:true,formatter:Slick.Formatters.Referrer},{id:"pagetime",name:"Page Time",field:"TimeOnPage",width:65,sortable:true,formatter:Slick.Formatters.Seconds},{id:"sitetime",name:"Site Time",field:"TimeOnSite",width:65,sortable:true,formatter:Slick.Formatters.Seconds}];
}visitorsGrid=new Slick.Grid(".visitors-grid",e,visitorsColumns,b);visitorsGrid.registerPlugin(h);visitorsGrid.setSelectionModel(new Slick.RowSelectionModel());
visitorsGrid.onSelectedRowsChanged.subscribe(function(){rows=visitorsGrid.getSelectedRows();selectedVisitor=e.getItem(rows);if(selectedVisitor!==undefined){openVisitor(selectedVisitor);
}});visitorsGrid.onSort.subscribe(function(l,j){var k=j.sortCols;e.sort(function(t,s){for(var o=0,n=k.length;o<n;o++){var r=k[o].sortCol.field;var m=k[o].sortAsc?1:-1;
var q=t[r],p=s[r];var u=(q==p?0:(q>p?1:-1))*m;if(u!==0){return u;}}return 0;});visitorsGrid.invalidate();visitorsGrid.render();});e.onRowCountChanged.subscribe(function(m,j){visitorsGrid.updateRowCount();
visitorsGrid.render();if(selectedVisitor){var l=parseInt(selectedVisitor.ID,10);for(var k=0;k<j.current;k++){id=parseInt(e.mapRowsToIds([k])[0],10);if(l===id){visitorsGrid.setSelectedRows([k]);
}}}});e.onRowsChanged.subscribe(function(k,j){visitorsGrid.invalidateRows(j.rows);visitorsGrid.render();});e.beginUpdate();e.setItems(visitors);e.groupBy(function(k){var j="Browsing";
if(k.Active<0){j="Chat Ended";}else{if(k.Session>0){j="Chatting";}}return j;},function(k){var j=" visitor";if(k.count>1){j=" visitors";}return k.value+" - "+k.count+j;
},function(k,j){return k.value-j.value;});for(var f=0;f<e.getGroups().length;f++){e.expandGroup(e.getGroups()[f].value);}e.endUpdate();e.syncGridSelection(visitorsGrid,true);
if(d){if(visitors.length>0){$(".visitors-empty").hide();$(".visitors-grid").show();}else{$(".visitors-grid").hide();$(".visitors-empty").show();}}}else{if(d){$(".visitors-grid").hide();
$(".visitors-empty").show();}}window.setTimeout(updateVisitorsGrid,15000);},dataType:"json",error:function(f,h,g){window.setTimeout(updateVisitorsGrid,15000);
}});}}function openVisitor(b){var a=$("#visitor-details");if(b.title===undefined){a.find("#hostname").text(convertHostname(b));a.find("#useragent").text(b.UserAgent);
var c=convertBrowserIcon(b.UserAgent,false);if(a.find("#useragent-image").length===0){$('<img id="useragent-image" src="'+c+'" style="float:right; width:50px; height:50px"/>').prependTo(a.find(".useragent.value"));
}else{a.find("#useragent-image").attr("src",c);}a.find("#resolution").text(b.Resolution);a.find("#country-image").removeAttr("class").addClass(convertCountryIcon(b.Country));
a.find("#country").text(convertCountry(b));a.find("#referrer a").text(convertReferrer(b.Referrer)).attr("href",b.Referrer);a.find("#currentpage a").text(b.CurrentPage).attr("href",b.CurrentPage);
a.find("#chatstatus").text(b.ChatStatus);a.find("#pagehistory").text(b.PagePath);a.show();a.animate({width:"40%",opacity:1},250);}}function closeVisitor(){var b=$("#visitor-details"),a=b.width();
b.animate({width:0,opacity:0},250,function(){b.hide();selectedVisitor=false;visitorsGrid.setSelectedRows([]);});}var chatResponsesOpen=false,activechats=[],blockedchats=[];
function checkBlocked(c){var a=false,b=$(".chat-stack .dialog");$.each(blockedchats,function(d,e){if(e.id===c){a=true;return;}});if(!a){b.animate({bottom:"-145px"},250,function(){b.find(".unblock").hide();
b.find(".progressring img").attr("src","images/ProgressRing.gif");b.hide();});}else{b.find(".progressring img").attr("src","images/Block.png");b.find(".dialog-title").text("Chat Session Blocked");
b.find(".dialog-description").text("The chat session is blocked and inactive.");b.find(".unblock").show();b.show().animate({bottom:"1px"},250);}}$(document).ready(function(){$("#history-chat .close").click(function(){closeHistory();
});$("#responses .close").click(function(){closeResponses();});$("#account-details .back").click(function(){showAccounts();});$(".menu").lavaLamp({speed:500,easing:"easeInOutBack",fx:"easeInOutBack"});
$(".menu li a").click(function(){var r=$(this).data("type"),s=["home","statistics","history"];switchMenu(r);if($.inArray(r,s)>-1){$.jStorage.set("menu",r);
}});$(".notification .close").click(function(){closeNotification();return false;});$(".notification .close").hover(function(){$(this).css("background","url(./images/close-notification-hover.png) no-repeat;");
},function(){$(this).css("background","url(./images/close-notification.png) no-repeat;");});$(".settings .close, .settings .cancel").click(function(){closeSettings();
return false;});$(".settings .close").hover(function(){$(this).css("background","url(./images/close-balloon-white-hover.png) no-repeat;");},function(){$(this).css("background","url(./images/close-balloon-white.png) no-repeat;");
});$(".settings .save").click(function(){saveSettings();});$(".settingsmenu div").click(function(){var u=$(this).attr("id"),s=$(".settings-"+u),t=s.parent().find(".section"),r=$(".settings .save.button");
if(u==="htmlcode"){r.fadeOut();}else{r.fadeIn();}s.show();$.each(t,function(w,x){var v=$(x);if(v.attr("class").indexOf("settings-"+u)==-1){v.hide();}});
});$(".settingsmenu #htmlcode").click(function(){$(".copy.step1").zclip("remove");$(".copy.step1").zclip({path:"scripts/ZeroClipboard.swf",copy:function(){return $("textarea#htmlcodestep1").val();
},afterCopy:function(){$("textarea#htmlcodestep1").pulse({backgroundColor:["#dbf3f8","#ffffff"]},500,2);}});$(".copy.step2").zclip("remove");$(".copy.step2").zclip({path:"scripts/ZeroClipboard.swf",copy:function(){return $("textarea#htmlcodestep2").val();
},afterCopy:function(){$("textarea#htmlcodestep2").pulse({backgroundColor:["#dbf3f8","#ffffff"]},500,2);}});});$(".dropdown-toggle").dropdown();$(".operator li").click(function(){var r=$(this).find("a").text();
$(".operator .status").text(r);});$("#calendar").ical();$('#calendar td[class!="padding"][id!="separator"][id!="clear-separator"]').live("click",function(){var r=$(this).attr("id"),s=$(this);
$.jStorage.set("history-date",r);s.closest("table").find("td").removeClass("selected-date");s.addClass("selected-date");initHistoryGrid(r);});var g=$("#history-chat");
g.find(".btn.unblock").click(function(){var r=g.data("id"),s=g.find(".dialog");unblockChat(r,s);});var a=$(".chat-stack");a.find(".dialog .btn.unblock").click(function(){var t=a.find(".chat"),s=a.find(".dialog"),r;
$.each(t,function(u,v){if($(v).position().left===0){r=$(v);return;}});if(r!==undefined&&r.length>0){r=r.data("id");unblockChat(r,s);}});a.find(".chat").live("click",function(){var v=$(this),x=v.data("id"),w={top:parseInt(v.css("top"),10),left:parseInt(v.css("left"),10),bottom:parseInt(v.css("bottom"),10)},t=parseInt(v.css("z-index"),10),r=v.find(".scroll"),u=v.find(".message-alert").data("total");
if(t!=500){$(".chat-stack .chat").each(function(z,A){var y=$(A),B=parseInt(y.position().left,10);if(B===0){$(y).data("scroll",y.find(".scroll").scrollTop());
}});v.animate({"z-index":500,left:0,bottom:0,top:0,backgroundColor:"#fffff"},150,"easeInOutBack",function(){v.find(".inputs, input").fadeIn();v.find(".inputs input").focus();
var y=v.data("scroll");if(u>0){y=v.find(".scroll .end");}checkBlocked(x);if(y!==undefined){v.find(".scroll").scrollTo(y);}});$(".chat-stack .smilies.button").close();
v.find(".name").hide();var s=v.find(".message-alert");$(s).data("total",0).hide();$(".chat-stack .chat").each(function(C,D){var B=$(D),F=parseInt(B.css("left"),10),y=parseInt(B.css("z-index"),10),E=0,A=2,z="#fafafa";
if(F<w.left){if(F>0){E=0;A=4;z="#f6f6f6";}B.animate({"z-index":y-10,top:E,left:F+35,bottom:A,backgroundColor:z},150,"easeInOutBack");B.find(".inputs, input").fadeOut();
B.find(".name").fadeIn();}});r.scrollTo(r.find(".end"));}});$("#visitor-details .close").click(function(){closeVisitor();});var b="body, input, textarea";
$(b).bind("keydown","esc",function(){processEscKeyDown();});$(b).bind("keydown","ctrl+shift+s",function(){openSettings();});$(b).bind("keydown","ctrl+shift+a",function(){openAccounts();
});$(b).bind("keydown","ctrl+shift+r",function(){openResponses();});$("#account-details .close").click(function(){closeAccount();});$("#response-list .response").live({mouseenter:function(){var r=$(this).find(".edit");
if(activechats.length>0&&$(".chat-stack").position().top>=0){r=$(this).find(".edit, .send");}r.animate({opacity:0.3},250);},mouseleave:function(){var r=$(this).find(".edit");
if(activechats.length>0&&$(".chat-stack").position().top>=0){r=$(this).find(".edit, .send");}r.animate({opacity:0},250);}});$("#response-list .response .edit, #response-list .response .send").live({mouseenter:function(){if(activechats.length>0&&$(".chat-stack").position().top>=0){var r=$(this);
r.animate({opacity:0.6},250);}},mouseleave:function(){if(activechats.length>0&&$(".chat-stack").position().top>=0){var r=$(this);r.animate({opacity:0.3},250);
}}});$("#response-list .response .edit").live("click",function(){var s=$(this).closest(".response"),v=s.data("id"),u=$("#responses #add-response"),t=["Text","Hyperlink","Image","PUSH","JavaScript"];
s=[];$.each(responses,function(w,x){if($.inArray(w,t)>-1){$.each(x,function(y,z){if(parseInt(z.ID,10)===v){s=z;return false;}});}});$(":input#ResponseID").val(s.ID);
$(":input#ResponseName").val(s.Name);$(":input#ResponseCategory").val(s.Category);var r="Text";switch(s.Type){case 2:r="Hyperlink";break;case 3:r="Image";
break;case 4:r="PUSH";break;case 5:r="JavaScript";break;}$("#ResponseType"+r).attr("checked","checked");if(r==="Text"){$("#ResponseContent").val(s.Content);
$("#add-response .URL").hide();$("#add-response .Content").show();}else{$(":input#ResponseURL").val(s.Content);$("#add-response .Content").hide();$("#add-response .URL").val(s.Content).show();
}$(".add-response.tags").html("");p(s.Tags);l();});$(".chat-stack .smilies.button").on({mouseenter:function(){$(this).css("background","url(images/SmiliesHover.png)");
},mouseleave:function(){$(this).css("background","url(images/Smilies.png)");},click:function(){$(this).bubbletip($("#SmiliesTooltip"),{calculateOnShow:true}).open();
}});$(".chat-stack #message").live("focus",function(){$(".chat-stack .smilies.button").close();});$("#SmiliesTooltip span").click(function(){var s=$(this).attr("class").replace("sprite ",""),u="",r=$(".chat-stack textarea"),t=r.val();
switch(s){case"Laugh":u=":D";break;case"Smile":u=":)";break;case"Sad":u=":(";break;case"Money":u="$)";break;case"Impish":u=":P";break;case"Sweat":u=":\\";
break;case"Cool":u="8)";break;case"Frown":u=">:L";break;case"Wink":u=";)";break;case"Surprise":u=":O";break;case"Woo":u="8-)";break;case"Tired":u="X-(";
break;case"Shock":u="8-O";break;case"Hysterical":u="xD";break;case"Kissed":u=":-*";break;case"Dizzy":u=":S";break;case"Celebrate":u="+O)";break;case"Angry":u=">:O";
break;case"Adore":u="<3";break;case"Sleep":u="zzZ";break;case"Stop":u=":X";break;}r.val(t+u);});loadResponses();var k=$("#responses");k.find(":input.#search").live("keydown","return",filterResponses);
k.click(filterResponses);function l(){k.find(".back").fadeIn();k.find("#add-response").fadeIn();k.find(".header").text("Add Response");k.find(".search, #response-list").hide();
k.find(".button-toolbar.save").fadeIn().animate({bottom:"15px"},250,"easeInOutBack");}k.find(".add-small").click(function(){f();l();});function f(){k.find("#ResponseID").val("");
k.find("#ResponseName").val("");k.find("#ResponseCategory").val("");k.find("#ResponseTypeText").attr("checked","checked");k.find("#ResponseURL").val("");
k.find("#ResponseContent").val("");k.find("#ResponseTags").val("");k.find(".add-response.tags").html("");k.find(".URL").hide();k.find(".Content").show();
k.find(".InputError").hide();}k.find(".cancel.button").click(function(){f();c();});k.find(":input#ResponseName").on("keydown keyup change blur",function(){var r=$(this).attr("id");
validateField($(this),"#"+r+"Error");});k.find("#ResponseTypeText, #ResponseTypeJavaScript").on("click",function(){if($(this).is(":checked")){k.find(".URL").hide();
k.find(".Content").show();}});k.find("#ResponseTypeHyperlink, #ResponseTypeImage, #ResponseTypePUSH").on("click",function(){if($(this).is(":checked")){k.find(".Content").hide();
k.find(".URL").show();}});function o(r){if(k.find(":input#ResponseTypeHyperlink, :input#ResponseTypePUSH, :input#ResponseTypeImage").is(":checked")){if(/^(?:\b(https?|file):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$])$/i.test(r)){k.find("#ResponseURLError").removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);
}else{k.find("#ResponseURLError").removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);}}}k.find(":input#ResponseContent,:input#ResponseURL").on("keydown keyup change blur",function(){var s=k.find(".checkbox :input:checked").data("type"),r=k.find("#ResponseURL"),t=k.find("#ResponseContent");
if(s==="Text"||s==="JavaScript"){validateField(t,"#ResponseContentError");}else{o(r.val());}});function h(){var t=k.find("#ResponseID"),r=k.find("#ResponseName"),u=k.find("#ResponseCategory"),x=k.find(".checkbox :input:checked").data("type"),s=k.find("#ResponseURL"),w=k.find("#ResponseContent"),A=k.find("#ResponseTags"),B=true;
validateField(r,"#ResponseNameError");if(x==="Text"||x==="JavaScript"){validateField(w,"#ResponseContentError");w=w.val();}else{o(s.val());w=s.val();}function y(C){if(C!==undefined&&C.Responses!==undefined){updateResponses(C.Responses);
}f();c();}if(k.find(".CrossSmall").length===0){switch(x){case"Text":x=1;break;case"Hyperlink":x=2;break;case"Image":x=3;break;case"Hyperlink":x=4;break;
case"JavaScript":x=5;break;}var A=[],z="";$.each(k.find(".add-response .tag"),function(C,D){z=$(D).text();if(z.length>0&&$.inArray(D,A)===-1){A.push(z.toLowerCase());
}});A=A.join(";");var v={Session:session,ID:t.val(),Name:r.val(),Category:u.val(),Content:w,Type:x,Tags:A,Version:"4.0",Format:"json"};$.ajax({url:service+"?Responses",data:v,type:"POST",success:function(C){y(C);
},dataType:"json"});}}k.find(".save.button").click(function(){h();});function p(r){if(r!==undefined&&r.length>0){$.each(r,function(t,s){k.find(".add-response.tags").append('<span class="tag"><span class="tag-icon"></span>'+s.trim()+'<span class="delete" title="Delete"></span></span>');
});}}k.find(".btn.add-tag").click(function(){var s=k.find("#ResponseTags"),r=s.val().split(" ");p(r);s.val("");});$(".add-response.tags .tag").live({mouseenter:function(){$(this).find(".delete").css({opacity:0.3});
},mouseleave:function(){$(this).find(".delete").css({opacity:0.1});}});$(".add-response.tags .tag .delete").live("click",function(){$(this).closest(".tag").remove();
});function c(){k.find("#add-response").fadeOut();k.find(".header").text("Pre-typed Response");k.find(".back").fadeOut();var s=k.find(".button-toolbar.save"),r=s.height();
s.hide().css("bottom",-r+"px");k.find(".search, #response-list").fadeIn();}k.find(".back").click(function(){c();});$(".chat-stack .search").live("click",function(){chatResponsesOpen=true;
openResponses(function(){$("#responses :input#search").focus();});});$(document).bind("LiveHelp.AccountsUpdated",function(t,s){var r=$(".operators.list .visitor");
$.each(r,function(v,w){var u=$(w),x=u.data("id");$.each(s,function(z,A){if(parseInt(A.ID,10)==x){u.find(".name").text(A.Firstname);u.find(".department").text(A.Department);
var y=convertAccessLevel(A.Privilege);u.find(".accesslevel").text(y);}});});});updateUsers();function q(t){var r=$(".chat-stack .chat[data-id="+t+"]").find(".scroll"),s=r.find("div.end");
r.scrollTo(s);}function d(v,s){var u=s.split(" "),r="",t=false;$.each(u,function(w,x){x=x.replace(/[;?.\-,!]/ig,"");if($.inArray(x.toLowerCase(),tags)>-1){t=true;
}});if(t){r='<div class="responses-menu" data-message="'+v+'"><div class="close"></div><div style="font-family:Open Sans; font-size:28px; color:#999; font-weight:300; padding:10px">Pre-typed Responses (<span class="tag-text"></span>)</div><div class="responses-text-heading" style="font-family:Open Sans; font-size:20px; color:#999; font-weight:300; padding:5px 10px">Text</div><div class="responses-text" style="font-family:Open Sans; font-size:12px; color:#666; font-weight:300; padding:10px"></div><div class="responses-hyperlink-heading" style="font-family:Open Sans; font-size:20px; color:#999; font-weight:300; padding:5px 10px">Hyperlink</div><div class="responses-hyperlink" style="font-family:Open Sans; font-size:12px; color:#666; font-weight:300; padding:10px"></div><div class="responses-image-heading" style="font-family:Open Sans; font-size:20px; color:#999; font-weight:300; padding:5px 10px">Image</div><div class="responses-image" style="font-family:Open Sans; font-size:12px; color:#666; font-weight:300; padding:10px"></div><div class="responses-push-heading" style="font-family:Open Sans; font-size:20px; color:#999; font-weight:300; padding:5px 10px">PUSH</div><div class="responses-push" style="font-family:Open Sans; font-size:12px; color:#666; font-weight:300; padding:10px"></div><div class="responses-javascript-heading" style="font-family:Open Sans; font-size:20px; color:#999; font-weight:300; padding:5px 10px">JavaScript</div><div class="responses-javascript" style="font-family:Open Sans; font-size:12px; color:#666; font-weight:300; padding:10px"></div></div>';
}return r;}function e(v,t){var u=t.split(" "),s="",r=[];s=t;$.each(u,function(w,x){x=x.replace(/[;?.\-,!]/ig,"");if($.inArray(x.toLowerCase(),tags)>-1&&$.inArray(x.toLowerCase(),r)===-1){s=s.replace(x,'<span class="tag" data-message="'+v+'"><span class="icon"></span><span class="text">'+x+"</span></span>");
r.push(x.toLowerCase());}});return s;}(function n(){if(session.length>0){var s=service+"?Chats",t="Session="+session+"&Version=4.0",r=$(".chat-stack"),v=r.find(".chat");
$.each(v,function(z,B){var x=$(B),C=x.data("id"),w=x.data("closed"),A=false,y=false;$.each(activechats,function(D,E){if(E.id===C){A=true;return;}});$.each(blockedchats,function(D,E){if(E.id===C){y=true;
return;}});if(!A&&!y&&!w){activechats.push({id:C,typing:0,type:0,message:0});}});if(activechats.length>0){var u="";$.each(activechats,function(x,w){if(u.length>0){u+="|";
}u+=w.id+","+w.typing+","+w.type+","+w.message;});t+="&Data="+u+"&Format=json";$.ajax({url:s,data:t,type:"POST",success:function(x){var y=false,w="";if(x.MultipleMessages!==undefined&&x.MultipleMessages.Messages!==undefined){$.each(x.MultipleMessages.Messages,function(G,B){if(B!==undefined){var z=parseInt(B.ID,10),C=parseInt(B.Status,10),I=$(".chat-stack .chat[data-id="+z+"]"),E="left",F=0,A=0;
w="";if(B.Message!==undefined&&B.Message.length>0){$.each(B.Message,function(T,S){var J=parseInt(S.ID,10),O=parseInt(S.Status,10),V=S.Content,M=new Date.parse(S.Datetime),L=M.getHours()+":"+zeroFill(M.getMinutes(),2);
if(O>0){V=$("<div>").text(V).html();}if(O===3){var U=/(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)/im;
var R=U.exec(V);if(R!==null){V='<img src="'+R[0]+'" />';}}else{V=V.replace(/(?!.*(?:\.jpe?g|\.gif|\.png)$)((?:(?:http(?:s?))|(?:ftp)):\/\/[^\s|<|>|'|"]*)/img,'<a href="$1" target="_blank">$1</a>');
V=V.replace(/^(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)$/img,'<img src="$&"/>');}V=V.replace(/(\r\n|\r|\n)/g,"<br/>");
if(settings.Smilies!==0){V=htmlSmilies(V);}var Q=S.Username;if(O===1){$.each(accounts.Operator,function(W,X){if(X.Username===Q){Q=X.Firstname;return;}});
}Q=(Q.length>0)?"from "+capitaliseFirstLetter(Q):"";E=(O>0)?"right":"left";if(O===0){w+='<blockquote class="message '+E+'"><div style="margin-bottom: 3px">'+e(J,V)+'</div><div style="bottom:5px; right:5px; font-size:11px; float:right">'+Q+" at "+L+"</div></blockquote>";
w+=d(J,V);F++;}else{if(O>=0){w+='<blockquote class="message '+E+'"><div style="margin-bottom: 3px">'+V+'</div><div style="bottom:5px; right:5px; font-size:11px; float:right">'+Q+" at "+L+"</div></blockquote>";
}else{if(O===-2){w+='<div style="color:#666; font-size:12px; margin-left:20px; line-height:20px"><img src="../image.php?SIZE=20" style="float:left; margin-right:5px"/>'+capitaliseFirstLetter(V)+"</div>";
}else{if(O===-3){var N=parseInt(V.substring(V.length-1),10),K="";for(var P=1;P<=5;P++){if(N>=P){K+='<div class="rating-highlight"></div>';}else{K+='<div class="rating"></div>';
}}V=V.substring(0,V.length-2);switch(N){case 5:N="Excellent";break;case 4:N="Very Good";break;case 3:N="Good";break;case 2:N="Poor";break;case 1:N="Very Poor";
break;}w+='<div style="margin-left:20px">'+V+"<span>"+K+'<span style="margin-left:10px">'+N+"</span></span></div>";}}}}$.each(activechats,function(W,X){if(X.id===z){X.message=parseInt(S.ID,10);
A=X.message;activechats[W]=X;return;}});});}var D=I.data("closed");if(C===-1&&!D){w='<div style="margin-left:20px; text-align: center">The chat session has been closed.</div>';
I.data("closed",true);v=[];$.each(activechats,function(J,K){if(K.id!==z){v.push(K);return;}});activechats=v;}if(w.length>0&&!D){$(w).appendTo(I.find(".messages"));
w="";q(z);if(F>0){y=true;}if($(".chat-stack").position().top===0&&A>0){$("#chatting .visitor[data-id="+z+"]").data("messages",A);}if(parseInt(I.css("left"),10)>0&&F>0){var H=I.find(".message-alert");
F=parseInt($(H).data("total"),10)+F;$(H).data("total",F);H.text(F).show();}}}});}if(y&&messageSound!==undefined){messageSound.play();y=false;}},dataType:"json"});
}}window.setTimeout(n,2000);})();$(".chat-stack .send").on({click:function(){sendMessage();$(".responses-menu:visible").height(0).hide();return false;},mouseenter:function(){$(this).css({opacity:1}).removeClass("sprite SendButton").addClass("sprite SendButtonHover");
},mouseleave:function(){$(this).css({opacity:0.4}).removeClass("sprite SendButtonHover").addClass("sprite SendButton");}});var j=$(".chat-stack textarea");
j.bind("keydown","return",function(){sendMessage();return false;}).bind("keydown","ctrl+return",function(){var s=$(this),t=s.val(),u=s.caret().start,r=s.caret().end;
s.val(t.substr(0,u)+"\n"+t.substr(r)).caret(u+1,u+1);return false;});function m(){var s=$(this),x=s.data("message"),w=$(".responses-menu[data-message="+x+"]"),r=300,u=1,t=s.find(".text").text();
if(w.length===0){w=s.parent();}if(w.height()>0){r=0;u=0;}else{var v=0;w.find(".responses-text, .responses-hyperlink, .responses-image, .responses-push, .responses-javascript").html("").hide();
w.find(".responses-text-heading, .responses-hyperlink-heading, .responses-image-heading, .responses-push-heading, .responses-javascript-heading").hide();
$.each(responses,function(z,y){if(z==="Text"){v=0;$.each(y,function(A,B){$.each(B.Tags,function(E,C){C=C.toLowerCase();if(C===t.toLowerCase()){var D='<div class="response">'+B.Content+"</div>";
w.find(".tag-text").text(C);$(D).appendTo(w.find(".responses-text"));v++;}});});if(v>0){w.find(".responses-text-heading, .responses-text").show();}}else{if(z==="Hyperlink"){v=0;
$.each(y,function(A,B){$.each(B.Tags,function(E,C){C=C.toLowerCase();if(C===t.toLowerCase()){var D='<div class="response">'+B.Content+"</div>";w.find(".tag-text").text(C);
$(D).appendTo(w.find(".responses-hyperlink"));v++;}});});if(v>0){w.find(".responses-hyperlink-heading, .responses-hyperlink").show();}}else{if(z==="Image"){v=0;
$.each(y,function(A,B){$.each(B.Tags,function(E,C){C=C.toLowerCase();if(C===t.toLowerCase()){var D='<div class="response">'+B.Content+"</div>";w.find(".tag-text").text(C);
$(D).appendTo(w.find(".responses-image"));v++;}});});if(v>0){w.find(".responses-image-heading, .responses-image").show();}}else{if(z==="PUSH"){v=0;$.each(y,function(A,B){$.each(B.Tags,function(E,C){C=C.toLowerCase();
if(C===t.toLowerCase()){var D='<div class="response">'+B.Content+"</div>";w.find(".tag-text").text(C);$(D).appendTo(w.find(".responses-push"));v++;}});
});if(v>0){w.find(".responses-push-heading, .responses-push").show();}}else{if(z==="JavaScript"){v=0;$.each(y,function(A,B){$.each(B.Tags,function(E,C){C=C.toLowerCase();
if(C===t.toLowerCase()){var D='<div class="response">'+B.Content+"</div>";w.find(".tag-text").text(C);$(D).appendTo(w.find(".responses-javascript"));v++;
}});});if(v>0){w.find(".responses-javascript-heading, .responses-javascript").show();}}}}}}});r="100%";}w.animate({height:r,opacity:u},250,"easeOutBack",function(){$(this).toggle();
var y=$(this).closest(".chat").data("id");q(y);});}$(".responses-menu .response").live("click",function(){$(".chat-stack textarea").val($(this).text());
});$(".messages .tag, .responses-menu > .close").live("click",m);$(".chat-list-heading").click(function(){var s=$(this).next(),r=s.height();if(r===0){r=s.data("height");
}else{s.data("height",r);r=0;}toggleChatMenu(s,r);});initAdmin();});function initAdmin(){$(".loading").delay(500).fadeOut();var d=$.jStorage.get("session","");
if(d.length>0){session=d;signIn();}else{$(".login").fadeIn();}$("div.metro-pivot").metroPivot({selectedItemChanged:function(f){showVisitorChart();showChatChart();
},controlInitialized:function(){}});$.preloadImages("images/bubbletip/bubbletip.png");$(".twofactor .factor").hover(function(){$(this).find("span, img").animate({opacity:1},250);
},function(){if(!$(this).data("selected")){$(this).find("span").animate({opacity:0},250);$(this).find("img").animate({opacity:0.5},250);}}).click(function(){var g=$(".twofactorcode"),f=$(".login");
factor=$(this).data("factor");$(this).parent().find(".factor").each(function(j,k){var h=$(k);if(h.data("factor")!==factor){h.data("selected",false).find("img").animate({opacity:0.5},250);
h.find("span").animate({opacity:0},250);}});$(this).data("selected",true).find("span, img").animate({opacity:1},250);g.fadeIn();if(factor==="push"){g.find(".code").fadeOut(function(){g.find(".status span").text("Authenticate to send Duo PUSH request");
g.find(".status, .status img").fadeIn();});}else{if(factor==="sms"||factor==="token"){if(factor==="sms"){g.find(".code label").text("SMS Code");g.find(".hint-token").hide();
g.find(".hint-sms").show();}else{g.find(".code label").text("Token Code");g.find(".hint-sms").hide();g.find(".hint-token").text("Enter your hardware token code or Duo Mobile code").show();
}g.find(".status").fadeOut(function(){g.find(".code").fadeIn(function(){$(":input#twofactor").focus();});});}}$(":input#twofactor").focus();});$(".login input").keypress(function(f){if(f.which===13){signIn();
f.preventDefault();}});$(".login .signin").click(signIn);$(".login .clear").click(function(){$(".login .inputs :input").val("");});var e=$("#account-details");
var a=false;$(document).bind("dragover",function(h){var f=$("#account-dropzone, #account-upload"),j=$("#account-upload"),g=window.dropZoneTimeout;if(!g){j.addClass("in");
}else{clearTimeout(g);}if($.inArray(h.target,f)>-1){j.addClass("hover");if(!a){j.pulse({backgroundColor:["#e6f7fa","#ffffff"]},500,2,function(){a=false;
$(this).css("background","transparent");});a=true;}}else{j.removeClass("hover");}window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null;
j.removeClass("in hover");},100);});function c(f){if(f.preventDefault){f.preventDefault();}if(f.stopPropagation){f.stopPropagation();}if(f.dataTransfer!==undefined){f.dataTransfer.dropEffect="copy";
}return false;}$(document).bind("drop",function(k){c(k.originalEvent);var j=k.originalEvent.dataTransfer,h=j.files;if(j.files.length>0){var g=j.files[0],f=new FileReader();
f.onload=function(l){updateAccountImage(l.target.result);};accountFiles=g;f.readAsDataURL(g);}});$(document).bind("drop dragover",function(f){f.preventDefault();
});$("#account-upload").fileupload({url:service+"?Operators",dataType:"json",singleFileUploads:true,dropZone:$("#account-dropzone"),submit:function(g,f){return false;
}});e.find(".edit-button").click(function(){var h=$("#account-details"),g=h.find(".button-toolbar.edit"),f=h.find(".button-toolbar.edit").height();g.hide().css("bottom",-f+"px");
h.find(".value").hide();h.find(".LiveHelpInput, .password").fadeIn();h.find(".button-toolbar.save").fadeIn().animate({bottom:"15px"},250,"easeInOutBack");
h.find(".InputError").removeClass("TickSmall CrossSmall");});e.find(".cancel-button").click(closeAccountDetails);e.find(".add-button").click(function(){showAddAccount();
});e.find(".save-button").click(function(){var f=$("#account-details .header").text();if(f==="Add Account"){addAccount();}else{saveAccount();}});e.find(':input[id!="AccountUsername"][id!="AccountEmail"][id!="ConfirmPassword"], select, .password').on("keydown keyup change blur",function(){var f=$(this).attr("id");
validateField($(this),"#"+f+"Error");});e.find(':input[id="AccountUsername"]').on("keydown keyup change blur",function(){var f=$(this).attr("id");validateUsername($(this),"#"+f+"Error");
});e.find(':input[id="AccountEmail"]').on("keydown keyup change blur",function(){var f=$(this).attr("id");validateEmail($(this),"#"+f+"Error");});e.find(':input[id="AccountPasswordConfirm"]').on("keydown keyup change blur",function(){var f=$(this).attr("id");
validatePassword($(this),$("#AccountPassword").val(),"#"+f+"Error");});var b=$(".confirm-delete");e.find(".delete-button").click(function(){b.animate({bottom:0},250,"easeInOutBack");
});b.find(".delete").click(function(){b.find(".buttons").fadeOut();b.find(".progressring img").css({opacity:0.5});deleteAccount();});b.find(".cancel").click(function(){b.animate({bottom:"-90px"},250,"easeInOutBack");
});$(".operator .dropdown-menu.statusmode a").click(function(){var f=$(this).attr("class");if(f!=="Signout"){updateUsers(f,undefined,function(){refreshAccounts(f);
});}else{signOut();}});$("#pending").on("click",".visitor",$(this),function(g){var f=($(g.target).is(".visitor"))?$(g.target):$(g.target).parent();acceptChat(f);
closeNotification();});$(".chatting .visitor, .other-chatting .visitor").live("click",function(){var g=$(this).data("id"),f=$(this).data("user");openChat(g,f);
});$(".chat-stack").on("click",".chat .inputs > .close",function(){closeChats();if(chatResponsesOpen){closeResponses();chatResponsesOpen=false;}});$(window).resize(function(){if(historyGrid!==undefined){historyGrid.resizeCanvas();
}if(accountsGrid!==undefined){accountsGrid.resizeCanvas();}if(visitorsGrid!==undefined){visitorsGrid.resizeCanvas();}});$("#responses").live("click",".response",function(l){if(activechats.length>0&&$(".chat-stack").position().top>=0){var m=$(l.target).closest(".response").data("id"),g=["Text","Hyperlink","Image","PUSH","JavaScript"],f,h;
$.each(responses,function(o,n){if($.inArray(o,g)>-1){$.each(n,function(p,q){if(m===parseInt(q.ID,10)){f=q;h=o;return;}});}});if(f!==undefined){var k=$(".chat-stack #message"),j=f.Content;
if(h==="Hyperlink"||h==="PUSH"){j=f.Name+" - "+f.Content;}k.val(j);}}});$("#responses").on("click",".response .send",function(){var j=$(this).closest(".response").data("id"),g=["Text","Hyperlink","Image","PUSH","JavaScript"],f,h;
$.each(responses,function(l,k){if($.inArray(l,g)>-1){$.each(k,function(m,n){if(j===parseInt(n.ID,10)){f=n;h=l;return;}});}});return sendResponse(h,f);});
}function sendResponse(c,b){var e=$(".chat-stack .chat"),a;$.each(e,function(f,g){if($(g).position().left===0){a=$(g);return;}});if(a!==undefined&&a.length>0){if(c==="Text"){sendMessage(b.Content);
return false;}else{var d=a.data("id");sendCommand(d,c.toUpperCase(),b.Name,b.Content);return false;}}return false;}function acceptChat(c){var d=c.find(".details.name"),e=c.data("id"),b=d.text();
var a=-1;$.each(notifications,function(f,g){if(c.data("id")===g.id){a=f;g.notification.cancel();return false;}});if(typeof notifications[a]!=="undefined"){notifications.splice(a,1);
}c.css("background","#e2e2e2");d.text("Accepting Chat");c.find(".details.department").text("with "+b);c.find(".image").css({background:"url(images/ProgressRing.gif) no-repeat",opacity:0.5});
c.find(".details.accesslevel").html("&nbsp;");c.delay(3000).fadeOut(function(){$(this).remove();});if(e>0){updateUsers("Accept",e);}}var visitorChart,visitorChartData=[],visitorChartCursor,visitorChartEmpty=false;
function showVisitorChart(){var b="#00bbcc";var f=1;if(visitorChartData.length===0){for(var c=30;c>0;c--){var a=new Date(),k=Math.floor(Math.random()*(80-30+1))+30,e=Math.floor(Math.random()*(250-120+1))+120;
a.setDate(a.getDate()-c);visitorChartData.push({date:a,chats:k,visits:e});}visitorChartEmpty=true;}if(visitorChartEmpty){b="#cccccc";f=0.5;}$("#visitor-chart").parent().css("opacity",f);
visitorChart=new AmCharts.AmSerialChart();visitorChart.dataProvider=visitorChartData;visitorChart.categoryField="date";visitorChart.balloon.bulletSize=5;
visitorChart.addListener("dataUpdated",visitorChartDataUpdated);var d=visitorChart.categoryAxis;d.parseDates=true;d.minPeriod="DD";d.axisAlpha=0;d.dashLength=1;
d.boldPeriodBeginning=false;d.position="bottom";d.axisColor="#dadada";var l=visitorChart.balloon;l.adjustBorderColor=true;l.color=b;l.cornerRadius=5;l.borderAlpha=1;
l.borderColor=b;l.borderThickness=1;l.fillColor=b;l.fillAlpha=0.8;l.color="#f3f3f3";l.showBullet=true;l.fontSize=15;l.textShadowColor="#666";var h=new AmCharts.ValueAxis();
h.axisAlpha=0;h.dashLength=1;h.minimum=0;visitorChart.addValueAxis(h);var g=new AmCharts.AmGraph();g.type="line";g.valueField="visits";g.bullet="round";
g.bulletColor="#ffffff";g.bulletBorderColor=b;g.bulletBorderThickness=2;g.bulletSize=6;g.fillColors=b;g.fillAlphas=0.2;g.lineThickness=2;g.lineColor=b;
g.balloonText="[[category]]: [[value]] visitors";visitorChart.addGraph(g);var j=new AmCharts.AmGraph();j.type="column";j.valueField="chats";j.fillColors=b;
j.fillAlphas=0.5;j.lineColor=b;j.lineThickness=1;j.balloonText="[[value]] chats";j.startDuration=1;visitorChart.addGraph(j);visitorChartCursor=new AmCharts.ChartCursor();
visitorChartCursor.cursorPosition="mouse";visitorChartCursor.pan=false;visitorChartCursor.zoomable=false;visitorChartCursor.categoryBalloonEnabled=false;
visitorChartCursor.cursorAlpha=0;visitorChartCursor.categoryBalloonDateFormat="EEE DD MMM YYYY";visitorChart.addChartCursor(visitorChartCursor);visitorChart.fontFamily="Segoe UI";
visitorChart.fontSize=14;visitorChart.color="#666";visitorChart.write("visitor-chart");if(visitorChartEmpty===true){$("#visitor-empty").fadeIn();}}var weekdayChart,weekdayChartData=[],weekdayChartCursor,weekdayChartEmpty=false;
function showWeekdayChart(){var a="#00A4B0";var b=1;if(weekdayChartData.length===0){weekdayChartData=[{Day:"Sunday",Total:3,Average:1.5},{Day:"Monday",Total:4,Average:2},{Day:"Tuesday",Total:1,Average:1},{Day:"Wednesday",Total:5,Average:2.5},{Day:"Thursday",Total:3,Average:3},{Day:"Friday",Total:5,Average:1.7},{Day:"Saturday",Total:0,Average:1.5}];
weekdayChartEmpty=true;}if(weekdayChartEmpty){a="#cccccc";b=0.4;}$("#weekday-chart").css("opacity",b);weekdayChart=new AmCharts.AmSerialChart();weekdayChart.dataProvider=weekdayChartData;
weekdayChart.categoryField="Day";weekdayChart.balloon.bulletSize=5;weekdayChart.startDuration=1;var e=weekdayChart.categoryAxis;e.parseDates=false;e.minPeriod="DD";
e.axisAlpha=0;e.dashLength=1;e.boldPeriodBeginning=false;e.position="bottom";e.axisColor="#dadada";var d=weekdayChart.balloon;d.adjustBorderColor=true;
d.color=a;d.cornerRadius=5;d.borderAlpha=1;d.borderColor=a;d.borderThickness=1;d.fillColor=a;d.fillAlpha=0.8;d.color="#f3f3f3";d.showBullet=true;d.bulletSize=4;
d.fontSize=15;d.textShadowColor="#666";var f=new AmCharts.ValueAxis();f.axisAlpha=0;f.dashLength=1;f.minimum=0;weekdayChart.addValueAxis(f);var c=new AmCharts.AmGraph();
c.type="column";c.valueField="Average";c.bulletSize=0;c.fillColors=a;c.fillAlphas=0.5;c.lineThickness=1;c.lineColor=a;c.balloonText="[[category]]: [[value]] chats (average)";
weekdayChart.addGraph(c);weekdayChartCursor=new AmCharts.ChartCursor();weekdayChartCursor.cursorPosition="mouse";weekdayChartCursor.pan=false;weekdayChartCursor.zoomable=false;
weekdayChartCursor.categoryBalloonEnabled=false;weekdayChartCursor.cursorAlpha=0;weekdayChartCursor.categoryBalloonDateFormat="EEE DD MMM YYYY";weekdayChart.addChartCursor(weekdayChartCursor);
weekdayChart.fontFamily="Segoe UI";weekdayChart.fontSize=14;weekdayChart.color="#666";weekdayChart.write("weekday-chart");if(weekdayChartEmpty===true){$("#weekday-empty").fadeIn();
}}var chatChart,chatChartData=[],chatChartCursor,chatChartEmpty=false;function showChatChart(){var b="#00bbcc";var e=1;if(chatChartData.length===0){for(var c=30;
c>0;c--){var a=new Date(),h=Math.floor(Math.random()*(80-30+1))+30;a.setDate(a.getDate()-c);chatChartData.push({date:a,chats:h});}chatChartEmpty=true;}if(chatChartEmpty){b="#cccccc";
e=0.4;}$("#chat-chart").css("opacity",e);chatChart=new AmCharts.AmSerialChart();chatChart.dataProvider=chatChartData;chatChart.categoryField="date";chatChart.balloon.bulletSize=5;
chatChart.startDuration=1;chatChart.addListener("dataUpdated",chatChartDataUpdated);var d=chatChart.categoryAxis;d.parseDates=true;d.minPeriod="DD";d.axisAlpha=0;
d.dashLength=1;d.boldPeriodBeginning=false;d.position="bottom";d.axisColor="#dadada";var j=chatChart.balloon;j.adjustBorderColor=true;j.color=b;j.cornerRadius=5;
j.borderAlpha=1;j.borderColor=b;j.borderThickness=1;j.fillColor=b;j.fillAlpha=0.8;j.color="#f3f3f3";j.showBullet=true;j.bulletSize=4;j.fontSize=15;j.textShadowColor="#666";
var g=new AmCharts.ValueAxis();g.axisAlpha=0;g.dashLength=1;g.minimum=0;chatChart.addValueAxis(g);var f=new AmCharts.AmGraph();f.type="column";f.valueField="chats";
f.bulletSize=0;f.fillColors=b;f.fillAlphas=0.5;f.lineThickness=1;f.lineColor=b;f.balloonText="[[category]]: [[value]] chats";chatChart.addGraph(f);chatChartCursor=new AmCharts.ChartCursor();
chatChartCursor.cursorPosition="mouse";chatChartCursor.pan=false;chatChartCursor.zoomable=false;chatChartCursor.categoryBalloonEnabled=false;chatChartCursor.cursorAlpha=0;
chatChartCursor.categoryBalloonDateFormat="EEE DD MMM YYYY";chatChart.addChartCursor(chatChartCursor);chatChart.fontFamily="Segoe UI";chatChart.fontSize=14;
chatChart.color="#666";chatChart.write("chat-chart");if(chatChartEmpty===true){$("#chat-empty").fadeIn();}}function loadStatisticsChartData(){if(session.length>0){var a=service+"?Statistics",b="Session="+session+"&Timezone="+new Date().getUTCOffset()+"&Version=4.0&Format=json";
$.ajax({url:a,data:b,type:"POST",success:function(l){if(l.Statistics!==null&&l.Statistics!==undefined){var m=0,r=l.Statistics.Chats,d=l.Statistics.Visitors,j=l.Statistics.Duration,k=l.Statistics.Rating,c,q;
if(d!==null&&d!==undefined){c=new Date(d.Date).add(1).days();if(d!==null&&r!==null&&r.Data!==undefined){d.Data=d.Data.reverse();visitorChartData=[];for(m=0;
m<30;m++){visitorChartData.push({date:new Date(c).add(m).days(),chats:r.Data[m],visits:d.Data[m]});visitorChartEmpty=false;}}}showVisitorChart();if(r!==null&&r!==undefined&&r.Data!==undefined){var h=0.5;
c=new Date(r.Date).add(1).days();historyChartData=[];chatChartData=[];for(m=0;m<30;m++){if(m>23){historyChartData.push({date:new Date(c).add(m).days(),chats:r.Data[m]});
}if(m>28){color="#00637d";h=0.8;}else{color="#00bbcc";h=0.5;}chatChartData.push({date:new Date(c).add(m).days(),color:color,alpha:h,chats:r.Data[m]});chatChartEmpty=false;
}weekdayChartData=r.Weekday;}showChatChart();showHistoryChart();showWeekdayChart();var n=0;if(j!==null&&j!==undefined&&j.Data!==undefined){$.each(j.Data,function(s,t){n+=t;
});var f=parseInt(n/j.Data.length,10);var o=Math.floor(f/3600);var g=Math.floor((f-(o*3600))/60);var p=f-(o*3600)-(g*60)+" seconds";o=(o>0)?o+" hours ":"";
g=g+" minutes ";f=o+g+p;$(".statistics .averagechattime").text(f);}else{$(".statistics .averagechattime").text("Unavailable");}n=0;if(k!==null&&k!==undefined){ratingChartData=[{rating:"Excellent",total:parseInt(k.Excellent,10)},{rating:"Very Good",total:parseInt(k.VeryGood,10)},{rating:"Good",total:parseInt(k.Good,10)},{rating:"Poor",total:parseInt(k.Poor,10)},{rating:"Very Poor",total:parseInt(k.VeryPoor,10)},{rating:"Unrated",total:parseInt(k.Unrated,10)}];
ratingChartEmpty=false;var e=0;k=5;$.each(ratingChartData,function(s,t){if(t.total>0&&s<5){n+=t.total;e+=(k-s)*t.total;k--;}});if(n>0){e=(e/n).toFixed(2);
k=ratingChartData[5-parseInt(e,10)].rating;$(".statistics .averagechatrating").text(e+" "+k);}else{$(".statistics .averagechatrating").text("Unavailable");
}}else{$(".statistics .averagechatrating").text("Unavailable");}showRatingChart();}},dataType:"json"});}}function visitorChartDataUpdated(){if(!visitorChartEmpty){$("#visitor-chart").fadeTo(1000,1);
}}function chatChartDataUpdated(){if(!chatChartEmpty){$("#chat-chart").fadeTo(1000,1);}}var ratingChart,ratingChartData=[],ratingChartCursor,ratingChartEmpty=false;
function showRatingChart(){var d=false,a=["#00BBCC","#235A78","#439494","#4DAAAB","#B4DCED","#1A8BB2"],e=0.8,b="#0BC";if(ratingChartData.length===0){ratingChartData=[{rating:"Excellent",total:20},{rating:"Very Good",total:18},{rating:"Good",total:10},{rating:"Poor",total:4},{rating:"Very Poor",total:2},{rating:"Unrated",total:8}];
ratingChartEmpty=true;}if(ratingChartEmpty){a=["#2F3540","#666A73","#F2EDE4","#D9D1C7","#8C8681","#333333"];e=0.1;b="#CCC";}var g=$(".rating.histogram"),f=0,c=0,h=[".excellent",".verygood",".good",".poor",".verypoor",".unrated"];
$.each(ratingChartData,function(k,l){f+=parseInt(l.total,10);});c=250/f;$.each(h,function(k,l){g.find(l).css({background:b}).animate({width:ratingChartData[k].total*c},1000,"easeInOutBack");
});ratingChart=new AmCharts.AmPieChart();ratingChart.dataProvider=ratingChartData;ratingChart.titleField="rating";ratingChart.valueField="total";ratingChart.outlineColor="#eeedee";
ratingChart.outlineAlpha=1;ratingChart.outlineThickness=2;ratingChart.radius="30%";ratingChart.colors=a;ratingChart.pieAlpha=e;ratingChart.pullOutOnlyOne=true;
var j=ratingChart.balloon;j.adjustBorderColor=true;j.cornerRadius=5;j.borderAlpha=1;j.borderColor="#00BBCC";j.borderThickness=1;j.fillColor="[[color]]";
j.fillAlpha=e;j.color="#f3f3f3";j.showBullet=true;j.fontSize=15;j.textShadowColor="#666";ratingChart.write("rating-chart");if(ratingChartEmpty){$("#rating-empty").fadeIn();
}}var historyChart,historyChartData=[],historyChartCursor;function showHistoryChart(){var e=false;if(historyChartData.length===0){for(var b=7;b>0;b--){var a=new Date(),h=Math.floor(Math.random()*(20-5+1))+5;
a.setDate(a.getDate()-b);historyChartData.push({date:a,chats:h});}e=true;}historyChart=new AmCharts.AmSerialChart();historyChart.dataProvider=historyChartData;
historyChart.categoryField="date";historyChart.balloon.bulletSize=5;historyChart.addListener("dataUpdated",historyChartDataUpdated);var f=historyChart.categoryAxis;
f.parseDates=true;f.minPeriod="DD";f.axisAlpha=0;f.dashLength=0;f.boldPeriodBeginning=false;f.position="top";f.axisColor="#dadada";f.labelsEnabled=false;
f.gridAlpha=0;var d=historyChart.balloon;d.adjustBorderColor=true;d.color="#999999";d.cornerRadius=5;d.borderAlpha=1;d.borderColor="#999999";d.borderThickness=1;
d.fillColor="#999999";d.fillAlpha=0.8;d.color="#f3f3f3";d.showBullet=true;d.fontSize=15;d.textShadowColor="#666";var g=new AmCharts.ValueAxis();g.axisAlpha=0;
g.dashLength=0;g.labelsEnabled=false;g.minimum=0;g.gridAlpha=0.1;historyChart.addValueAxis(g);var c=new AmCharts.AmGraph();c.type="line";c.valueField="chats";
c.bullet="round";c.bulletColor="#ffffff";c.bulletBorderColor="#999999";c.bulletBorderThickness=2;c.bulletSize=6;c.fillColors="#999999";c.fillAlphas=0.2;
c.lineThickness=2;c.lineColor="#999999";c.balloonText="[[category]]: [[value]] chats";historyChart.addGraph(c);historyChartCursor=new AmCharts.ChartCursor();
historyChartCursor.cursorPosition="mouse";historyChartCursor.pan=false;historyChartCursor.zoomable=false;historyChartCursor.categoryBalloonEnabled=false;
historyChartCursor.cursorAlpha=0;historyChartCursor.categoryBalloonDateFormat="EEE DD MMM YYYY";historyChart.addChartCursor(historyChartCursor);historyChart.fontFamily="Segoe UI";
historyChart.fontSize=14;historyChart.color="#666";historyChart.write("history-chart");if(e){$("#history-empty").fadeIn();}}function historyChartDataUpdated(){$("#history-chart").fadeTo(1000,1);
}(function(){var b={};this.tmpl=function a(e,d){var c=!/\W/.test(e)?b[e]=b[e]||a(document.getElementById(e).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");
return d?c(d):c;};})();function ucwords(a){return(a+"").replace(/^([a-z])|\s+([a-z])/g,function(b){return b.toUpperCase();});}function strtolower(a){return(a+"").toLowerCase();
}function htmlSmilies(d){var c=[{regex:/:D/g,css:"Laugh"},{regex:/:\)/g,css:"Smile"},{regex:/:\(/g,css:"Sad"},{regex:/\$\)/g,css:"Money"},{regex:/&gt;:O/g,css:"Angry"},{regex:/:P/g,css:"Impish"},{regex:/:\\/g,css:"Sweat"},{regex:/8\)/g,css:"Cool"},{regex:/&gt;:L/g,css:"Frown"},{regex:/;\)/g,css:"Wink"},{regex:/:O/g,css:"Surprise"},{regex:/8-\)/g,css:"Woo"},{regex:/8-O/g,css:"Shock"},{regex:/xD/g,css:"Hysterical"},{regex:/:-\*/g,css:"Kissed"},{regex:/:S/g,css:"Dizzy"},{regex:/\+O\)/g,css:"Celebrate"},{regex:/&lt;3/g,css:"Adore"},{regex:/zzZ/g,css:"Sleep"},{regex:/:X/g,css:"Stop"},{regex:/X-\(/g,css:"Tired"}];
for(var b=0;b<c.length;b++){var a=c[b];d=d.replace(a.regex,'<span title="'+a.css+'" class="sprite '+a.css+'Small Smilie"></span>');}return d;}function openHome(){$(".history, .statistics").fadeOut();
$(".visitors-grid").fadeIn();if(visitors!==undefined&&visitors.length>0){$(".visitors-empty").hide();$(".visitors-grid").fadeIn();}}function loadSettings(a){settings=a;
$("#domainname").val(a.Domain);$("#siteaddress").val(a.SiteAddress);$("#livehelpname").val(a.Name);if(a.VisitorTracking!==0){$("#visitortracking-enable").attr("checked","checked");
}else{$("#visitortracking-disable").attr("checked","checked");}if(a.Departments!==0){$("#departments-enable").attr("checked","checked");}else{$("#departments-disable").attr("checked","checked");
}$("#welcomenote").val(a.WelcomeMessage);$("#template").find("option").remove();$.each(a.Templates,function(b,c){$("#template").append('<option value="'+c.value+'">'+c.name+"</option>");
});if(a.Smilies!==0){$("#smilies-enable").attr("checked","checked");enableSmilies();}else{$("#smilies-disable").attr("checked","checked");disableSmilies();
}$("#backgroundcolor").val(a.BackgroundColor);$("#generalfont").val(a.Font.Type);$("#generalfontsize").val(a.Font.Size);$("#generalfontcolor").val(a.Font.Color);
$("#generalfontlinkcolor").val(a.Font.LinkColor);$("#guestchatfont").val(a.ChatFont.Type);$("#guestchatfontsize").val(a.ChatFont.Size);$("#sentcolor").val(a.ChatFont.SentColor);
$("#receivedcolor").val(a.ChatFont.ReceivedColor);$("#chatwindowsize").val(a.ChatWindowSize.Width+" x "+a.ChatWindowSize.Height);$(":input#backgroundcolor, :input#sentcolor, :input#receivedcolor, :input#generalfontcolor, :input#generalfontlinkcolor").miniColors();
if(window.webkitNotifications){$("#html5-notifications-enable").attr("checked","checked");if($.jStorage.get("html5-notifications",true)){checkHTML5NotificationsPermission();
}else{$("#html5-notifications-disable").attr("checked","checked");}}else{$("#html5-notifications-disable").attr("checked","checked");$(".html5-notifications input").attr("disabled","disabled");
$.jStorage.set("html5-notifications",false);}$("#logo").val(a.Logo);$("#campaignimage").val(a.Campaign.Image);$("#campaignlink").val(a.Campaign.Link);$("#onlineimage").val(a.OnlineLogo);
$("#offlineimage").val(a.OfflineLogo);$("#berightbackimage").val(a.BeRightBackLogo);$("#awayimage").val(a.AwayLogo);$("#htmlcodestep1").val(a.Code.Head);
$("#htmlcodestep2").val(a.Code.Image);$("#emailaddress").val(a.Email);$("#offlineurlredirection").val(a.OfflineEmail.Redirect);if(a.OfflineEmail.Enabled!==0){$("#email-enable").attr("checked","checked");
}else{$("#email-disable").attr("checked","checked");}$("#autoinitiatechat-enable").click(function(){if($(this).is(":checked")){$(".autoinitiate-pageviews").fadeIn();
}});$("#autoinitiatechat-disable").click(function(){if($(this).is(":checked")){$(".autoinitiate-pageviews").fadeOut();}});if(a.InitiateChat.Auto>0){$("#autoinitiatechat-enable").attr("checked","checked");
$("#autoinitiatechat-pages").val(a.InitiateChat.Auto).show();}else{$("#autoinitiatechat-disable").attr("checked","checked");$("#autoinitiatechat-pages").val(a.InitiateChat.Auto).hide();
}$("#verticalalignment").val(a.InitiateChat.Vertical);$("#horizontalalignment").val(a.InitiateChat.Horizontal);if(a.ChatUsername!==0){$("#displaychatusername-enable").attr("checked","checked");
}else{$("#displaychatusername-disable").attr("checked","checked");}if(a.LoginDetails.Required!==0){$("#guestlogindetails-required").attr("checked","checked");
}else{if(a.LoginDetails.Enabled!==0){$("#guestlogindetails-optional").attr("checked","checked");}else{$("#guestlogindetails-disable").attr("checked","checked");
}}if(a.LoginDetails.Email!==0){$("#guestemailaddress-enable").attr("checked","checked");}else{$("#guestemailaddress-disable").attr("checked","checked");
}if(a.LoginDetails.Question!==0){$("#guestquestion-enable").attr("checked","checked");}else{$("#guestquestion-disable").attr("checked","checked");}if(a.SecurityCode!==0){$("#securitycode-enable").attr("checked","checked");
}else{$("#securitycode-disable").attr("checked","checked");}$("#p3p").val(a.P3P);}function enableSmilies(){$(".smilies.button").show();}function disableSmilies(){$(".smilies.button").hide();
}function checkHTML5NotificationsPermission(){switch(window.webkitNotifications.checkPermission()){case 0:$(".html5-notifications input").removeAttr("disabled");
$.jStorage.set("html5-notifications",true);break;case 2:$(".html5-notifications input").attr("disabled","disabled");$.jStorage.set("html5-notifications",false);
break;}}function openSettings(){var c=$(".settings"),e=$(".settingsmenu");if(c.is(":hidden")){var d=$(".settingsmenu > div:not(#htmlcode, #alerts, .backLava)");
if(operator.access>=2){d.remove();e.find("#alerts").click();}c.show();$(".general").mouseover();$(".settings").animate({height:600,opacity:1},250,"easeInOutBack",function(){$(this).find(".button-toolbar").animate({bottom:"15px"},250,"easeInOutBack");
});if(e.find(".backLava").length===0){e.lavaLamp({target:"div",container:"div",speed:250,includeMargins:true,easing:"easeOutBack",fx:"easeOutBack"});}var a=service+"?Settings",b={Session:session,Version:"4.0",Format:"json"};
$.ajax({url:a,data:b,type:"POST",success:function(f){if(f.Settings!==undefined){loadSettings(f.Settings);}},dataType:"json"});$(".html5-notifications input").click(function(){if(window.webkitNotifications){if($("#html5-notifications-enable").is(":checked")){window.webkitNotifications.requestPermission(checkHTML5NotificationsPermission);
}else{$.jStorage.set("html5-notifications",false);}}else{$(".html5-notifications input").attr("disabled","disabled");$.jStorage.set("html5-notifications",false);
}});}}function saveSettings(){if(operator.access>=2){return;}var c=service+"?Settings",e=($("#settings :input#smilies-enable").is(":checked"))?-1:0,o=($("#settings :input#visitortracking-enable").is(":checked"))?-1:0,m=($("#settings :input#departments-enable").is(":checked"))?-1:0,p=($("#settings :input#email-enable").is(":checked"))?-1:0,f=($("#settings :input#guestemailaddress-enable").is(":checked"))?-1:0,a=($("#settings :input#guestquestion-enable").is(":checked"))?-1:0,b=($("#settings :input#displaychatusername-enable").is(":checked"))?-1:0,g=($("#settings :input#securitycode-enable").is(":checked"))?-1:0,k=($("#settings :input#guestlogindetails-disable").is(":checked"))?0:-1,l=($("#settings :input#guestlogindetails-required").is(":checked"))?-1:0,j=$("#settings select#chatwindowsize").val(),h={width:parseInt(j.substring(0,j.indexOf(" x ")),10),height:parseInt(j.substring(j.indexOf(" x ")+3),10)},d={Session:session,Domain:$("#settings :input#domainname").val(),URL:$("#settings :input#siteaddress").val(),Email:$("#settings :input#emailaddress").val(),Name:$("#settings :input#livehelpname").val(),Logo:$("#settings :input#logo").val(),Introduction:$("#settings :input#welcomenote").val(),Smilies:e,Font:$("#settings :input#generalfont").val(),FontSize:$("#settings :input#generalfontsize").val(),FontColor:$("#settings :input#generalfontcolor").val(),ChatFont:$("#settings :input#guestchatfont").val(),SentFontColor:$("#settings :input#sentcolor").val(),ReceivedFontColor:$("#settings :input#receivedcolor").val(),LinkColor:$("#settings :input#generalfontlinkcolor").val(),BackgroundColor:$("#settings :input#backgroundcolor").val(),ChatFontSize:$("#settings :input#guestchatfontsize").val(),OfflineLogo:$("#settings :input#offlineimage").val(),OnlineLogo:$("#settings :input#onlineimage").val(),OfflineEmailLogo:$("#settings :input#offlineimage").val(),BeRightBackLogo:$("#settings :input#berightbackimage").val(),AwayLogo:$("#settings :input#awayimage").val(),LoginDetails:k,LoginEmail:f,LoginQuestion:a,OfflineEmail:p,OfflineEmailRedirect:$("#settings :input#offlineurlredirection").val(),SecurityCode:g,Departments:m,VisitorTracking:o,Locale:$("#settings :input#language").val(),InitiateChatVertical:$("#settings :input#verticalalignment").val(),InitiateChatHorizontal:$("#settings :input#horizontalalignment").val(),InitiateChatAuto:$("#settings :input#autoinitiatechat-pages").val(),ChatUsername:b,CampaignImage:$("#settings :input#campaignimage").val(),CampaignLink:$("#settings :input#campaignlink").val(),IP2Country:-1,P3P:$("#settings :input#p3p").val(),ChatWindowWidth:h.width,ChatWindowHeight:h.height,RequireGuestDetails:l,Template:$("#settings :input#template").val(),Format:"json",Version:"4.0"};
var n=$(".settings-dialog");n.find(".progressring").show();n.find(".dialog-title").text("Saving Settings");n.find(".dialog-description").text("One moment while your settings are saved.");
n.animate({bottom:0},250,"easeInOutBack");$.ajax({url:c,data:d,type:"POST",success:function(q){if(q.Settings!==undefined){loadSettings(q.Settings);n.find(".progressring").hide();
n.find(".dialog-title").text("Settings Saved Successfully");n.find(".dialog-description").text("Your settings were saved successfully.");}n.delay(1000).animate({bottom:-90},250,"easeInOutBack");
},error:function(q,s,r){n.find(".progressring").hide();n.find(".dialog-title").text("Error Saving Settings");n.find(".dialog-description").text("An error occurred while saving the settings.  Please contact technical support.");
n.delay(3000).animate({bottom:-90},250,"easeInOutBack");},dataType:"json"});}function closeSettings(){$(".miniColors-selector").hide();$(".settings").animate({height:0,opacity:0},250,"easeInOutBack",function(){$(this).hide();
$(this).find(".button-toolbar").animate({bottom:"-90px"},250,"easeInOutBack");});switchPreviousMenu();}function zeroFill(b,a){a-=b.toString().length;if(a>0){return new Array(a+(/\./.test(b)?2:1)).join("0")+b;
}return b;}function capitaliseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1);}function openHistoryChat(e){var g=$("#history-chat"),b=service+"?Chats",a=parseInt(e.Session,10),f=parseInt(e.Active,10),d="Session="+session+"&Data="+a+",0,0,0&Version=4.0&Format=json";
if(a>0){g.data("id",a);g.find(".name").text(e.Username+" - "+$(e.Email).text());g.find(".messages").html("");var c=g.find(".dialog");if(f===-3){c.show().animate({bottom:"1px"},250);
}else{c.hide().animate({bottom:"-145px"},250);}$.ajax({url:b,data:d,type:"POST",success:function(k){if(k.MultipleMessages!==undefined&&k.MultipleMessages.Messages!==undefined){var j=k.MultipleMessages.Messages[0],h="",l="left";
if(parseInt(j.ID,10)===a&&j.Message.length>0){$.each(j.Message,function(v,u){var q=parseInt(u.Status,10),x=u.Content,o=new Date.parse(u.Datetime),n=o.getHours()+":"+zeroFill(o.getMinutes(),2);
if(q>0){x=$("<div>").text(x).html();}if(q===3){var w=/(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)/im;
var t=w.exec(x);if(t!==null){x='<img src="'+t[0]+'" />';}}else{x=x.replace(/(?!.*(?:\.jpe?g|\.gif|\.png)$)((?:(?:http(?:s?))|(?:ftp)):\/\/[^\s|<|>|'|"]*)/img,'<a href="$1" target="_blank">$1</a>');
x=x.replace(/^(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)$/img,'<img src="$&"/>');}if(settings.Smilies!==0){x=htmlSmilies(x);
}var s=u.Username;if(q===1){$.each(accounts.Operator,function(y,z){if(z.Username===s){s=z.Firstname;return;}});}s=(s.length>0)?"from "+capitaliseFirstLetter(s):"";
l=(q>0)?"right":"left";if(q===0){h+='<blockquote class="message '+l+'"><div style="margin-bottom: 3px">'+x+'</div><div style="bottom:5px; right:5px; font-size:11px; float:right">'+s+" at "+n+"</div></blockquote>";
}else{if(q>=0){h+='<blockquote class="message '+l+'"><div style="margin-bottom: 3px">'+x+'</div><div style="bottom:5px; right:5px; font-size:11px; float:right">'+s+" at "+n+"</div></blockquote>";
}else{if(q===-2){h+='<div style="color:#666; font-size:12px; margin-left:20px; line-height:20px"><img src="../image.php?SIZE=20" style="float:left; margin-right:5px"/>'+capitaliseFirstLetter(x)+"</div>";
}else{if(q===-3){var p=parseInt(x.substring(x.length-1),10),m="";for(var r=1;r<=5;r++){if(p>=r){m+='<div class="rating-highlight"></div>';}else{m+='<div class="rating"></div>';
}}x=x.substring(0,x.length-2);switch(p){case 5:p="Excellent";break;case 4:p="Very Good";break;case 3:p="Good";break;case 2:p="Poor";break;case 1:p="Very Poor";
break;}h+='<div style="margin-left:20px">'+x+"<span>"+m+'<span style="margin-left:10px">'+p+"</span></span></div>";}}}}});$(h).appendTo("#history-chat .messages");
}}},dataType:"json"});g.show();g.animate({width:"40%",opacity:1},250);}}function closeHistory(){var b=$("#history-chat"),a=b.width();b.animate({width:0,opacity:0},250,function(){b.hide();
});}var historyGrid,historyColumns;function initHistoryGrid(e){var d=tmpl("history_template");function b(z,x,u,s,j){var q="Chrome",k="",v=j.Country;u=j.UserAgent;
if(u.indexOf("MSIE")!==-1){q="InternetExplorer";}else{if(u.indexOf("Chrome")!==-1){q="Chrome";}else{if(u.indexOf("Opera")!==-1){q="Opera";}else{if(u.indexOf("Safari")!==-1){q="Safari";
}else{if(u.indexOf("Firefox")!==-1){q="Firefox";}}}}}j.Username=ucwords(j.Username.toLowerCase());j.UserAgent="./images/"+q+".png";if(j.State!==null&&j.State.length>0){if(j.City!==null&&j.City.length>0){v=j.City+", "+j.State+", "+j.Country;
}else{v=j.State+", "+j.Country;}}else{if(j.City!==null&&j.City.length>0){v=j.City+", "+j.Country;}}k='<span class="'+convertCountryIcon(j.Country)+'" style="float:left; margin: 3px 5px 3px 0; display:inline-block"></span>';
j.Location=k+v;if(j.Department.length===0){j.Department="Unavailable";}if(j.Email.length>0){if(!$(j.Email).text().length){j.Email='<a href="mailto:'+j.Email+'">'+j.Email+"</a>";
}}else{j.Email="Unavailable";}if(!$(j.CurrentPage).text().length){j.CurrentPage='<a href="'+j.CurrentPage+'" target="_blank">'+j.CurrentPage+"</a>";}var t=j.Referrer,y=/^http[s]{0,1}:\/\/(?:[^.]+[\\.])*google(?:(?:.[a-z]{2,3}){1,2})[\/](?:search|url|imgres)(?:\?|.*&)q=([^&]*)/i,p=y.exec(t);
if(p!==null){if(p[1].length>0){t="Google Search (Keywords: "+p[1]+")";}else{t="Google Search";}}j.Referrer=t;var l=parseInt(j.Rating,10),w="No Rating",o="";
switch(l){case 1:w="Very Poor";break;case 2:w="Poor";break;case 3:w="Good";break;case 4:w="Very Good";break;case 5:w="Excellent";break;}for(var n=1;n<=5;
n++){var r="",m="";if(l>=n){r="-highlight";}if(l===0){m=" rating-disabled";}o+='<div class="rating'+r+m+'"></div>';}o+='<span style="margin-left:5px">'+w+"</span>";
j.Rating=o;return d(j);}var h,a={rowHeight:220,enableCellNavigation:true,enableColumnReorder:false,multiColumnSort:true,multiSelect:false};if(e===undefined){e=$.jStorage.get("history-date","");
var g=$(".history #calendar");g.find("td").removeClass("selected-date");g.find('td[id="'+e+'"]').addClass("selected-date");e=(e.length>0)?new Date.parse(e):new Date();
e=e.getFullYear()+"-"+zeroFill(e.getMonth()+1,2)+"-"+zeroFill(e.getDate(),2);}if(session.length>0){var c=service+"?History",f="Session="+session+"&StartDate="+e+"&EndDate="+e+"&Timezone="+new Date().getUTCOffset()+"&Transcripts=1&ID=0&Version=4.0&Format=json";
$.ajax({url:c,data:f,type:"POST",success:function(k){if(k.ChatHistory!==undefined){h=[];$.each(k.ChatHistory,function(m,n){h.push(n.Visitor);});h=h.reverse();
if(historyGrid!==undefined){historyColumns=historyGrid.getColumns();}else{historyColumns=$.jStorage.get("historyColumns",[{id:"history",name:"Chat History",field:"Username",headerCssClass:"username-column-header",width:550,formatter:b,sortable:true,resizable:true},{id:"date",name:"Date",field:"Date",width:150,formatter:Slick.Formatters.Date,sortable:true,resizable:true}]);
historyColumns[0].formatter=b;historyColumns[1].formatter=Slick.Formatters.Date;}historyGrid=new Slick.Grid(".history-grid",h,historyColumns,a);historyGrid.setSelectionModel(new Slick.RowSelectionModel());
historyGrid.onColumnsResized.subscribe(function(){$.jStorage.set("historyColumns",historyGrid.getColumns());});historyGrid.onSelectedRowsChanged.subscribe(function(){rows=historyGrid.getSelectedRows();
chat=h[rows];if(chat!==undefined){openHistoryChat(chat);}});historyGrid.onSort.subscribe(function(o,m){var n=m.sortCols;h.sort(function(w,v){for(var r=0,q=n.length;
r<q;r++){var u=n[r].sortCol.field;var p=n[r].sortAsc?1:-1;var t=w[u],s=v[u];var x=(t==s?0:(t>s?1:-1))*p;if(x!==0){return x;}}return 0;});historyGrid.invalidate();
historyGrid.render();});var l="",j=h.length;if(j>1){l=" - "+h.length+" chats";}else{if(j>0){l=" - "+h.length+" chat";}}if(j>0){$(".history-empty").hide();
$(".history-grid").show();}else{$(".history-grid").hide();$(".history-empty").show();}$(".username-column-header .slick-column-name").text("Chat History"+l);
}},dataType:"json"});}}function sliderIndex(){var b=$(".slider.right"),a=0;if(b.length>0){$.each(b,function(e,f){var d=$(f),c=parseInt(d.css("z-index"),10);
if(d.width()>0&&c>a){a=c;}});}return a;}function openResponses(b){var a=$("#responses");a.show();a.css("z-index",sliderIndex()+100);a.animate({width:"40%",opacity:1},250,function(){if(b){b();
}});}function closeResponses(){var b=$("#responses"),a=b.width();b.find(".search input").val("");filterResponses();b.animate({width:0,opacity:0},250,function(){b.hide();
});switchPreviousMenu();}var accountsLoaded=false;function lastUpdatedAccount(a){var b=null;$.each(a,function(d,e){var c=new Date.parse(e.Updated);if(!b||c>b){b=c;
}});return b;}function showAccountsGrid(c){var e=$.jStorage.get("accounts",[]),b=lastUpdatedAccount(e);$.jStorage.set("accounts",c);$(document).trigger("LiveHelp.AccountsUpdated",[c]);
var a=false;$.each(e,function(g,j){var f=parseInt(j.ID,10),h=false;$.each(c,function(l,m){var k=parseInt(m.ID,10);if(f===k){h=true;}});if(!h){a=true;}});
var d=lastUpdatedAccount(c);if(d>b||a){updateAccountsGrid(c);}}var accountsGrid,accounts,columns=[{id:"account",name:"",field:"Username",formatter:renderAccountCell,sortable:true}],options={rowHeight:80,enableCellNavigation:true,enableColumnReorder:false,forceFitColumns:true,multiColumnSort:true,multiSelect:false},accountTemplate=null;
function renderAccountCell(g,b,f,d,a){var e=a,c=parseInt(e.Status,10);if(!accountTemplate){accountTemplate=tmpl("account_template");}if(!isNaN(c)){switch(c){case 0:c="Offline";
break;case 1:c="Online";break;case 2:c="Be Right Back";break;case 3:c="Away";break;}e.Status=c;}e.Image="../image.php?ID="+e.ID+"&SIZE=100";return accountTemplate(e);
}function updateAccountsGrid(a){accountsGrid=new Slick.Grid(".accounts-grid",a,columns,options);accountsGrid.setSelectionModel(new Slick.RowSelectionModel());
accountsGrid.onSelectedRowsChanged.subscribe(function(){rows=accountsGrid.getSelectedRows();account=a[rows];if(account!==undefined){var b=$.jStorage.get("accounts",[]);
$.each(b,function(c,d){if(parseInt(account.ID,10)===parseInt(d.ID,10)){account=d;}});showAccount(account);accountsGrid.setSelectedRows([]);accountsGrid.resetActiveCell();
}});accountsGrid.onSort.subscribe(function(d,b){var c=b.sortCols;a.sort(function(n,m){for(var g=0,f=c.length;g<f;g++){var k=c[g].sortCol.field;var e=c[g].sortAsc?1:-1;
var j=n[k],h=m[k];var o=(j==h?0:(j>h?1:-1))*e;if(o!==0){return o;}}return 0;});accountsGrid.invalidate();accountsGrid.render();});}function initAccountsGrid(g){if(session.length>0){var b=service+"?Operators",d=new Date().toString("yyyy-MM-dd HH:mm:ss"),c="Session="+session+"&Cached="+d+"&Version=4.0&Format=json",f=$.jStorage.get("accounts",[]),a=lastUpdatedAccount(f);
if(f.length>0&&$("#account-details").is(":visible")&&!accountsLoaded){if(g!==undefined&&g===true){updateAccountsGrid(f);accountsLoaded=true;}}else{var e=$(".accounts-grid .cell-inner");
$.each(e,function(h,j){var k=$(j).data("id");j=$(j);$.each(accounts.Operator,function(m,n){var l="Offline";if(k===parseInt(n.ID,10)){switch(parseInt(n.Status,10)){case 1:l="Online";
break;case 2:l="Be Right Back";break;case 3:l="Away";break;}j.find(".cell-details.name").text(n.Firstname+" "+n.Lastname);j.find(".cell-details.department").text(n.Department);
j.find(".cell-details.status").text(l);return;}});});}$.ajax({url:b,data:c,type:"POST",success:function(h){if(h.Operators!==undefined&&h.Operators.Operator!==undefined){accounts=h.Operators;
$.jStorage.set("accounts",accounts.Operator);$(document).trigger("LiveHelp.AccountsUpdated",[accounts.Operator]);if(g!==undefined&&g===true){showAccountsGrid(h.Operators.Operator);
}}},dataType:"json"});}}function closeAccountDetails(){var c=$("#account-details"),b=c.find(".button-toolbar.save"),a=c.find(".button-toolbar.edit"),d=c.find(".header").text();
height=b.height();if(d==="Add Account"||a.is(":visible")){showAccounts();return;}c.find(".LiveHelpInput, .password").hide();c.find(".value, .button-toolbar.edit").fadeIn();
b.hide().css("bottom",-height+"px");a.fadeIn().animate({bottom:"15px"},250,"easeInOutBack");}function validateField(b,c){var a=(b instanceof $)?b.val():$(b).val();
if($.trim(a)===""){$(c).removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);return false;}else{$(c).removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);
return true;}}function validateUsername(d,f){var c=(d instanceof $)?d.val():$(d).val(),b=$.jStorage.get("accounts",[]),a=false,e=$("#AccountID").val();
e=(e.length>0)?parseInt(e,10):0;$.each(b,function(g,h){h.ID=parseInt(h.ID,10);if((h.Username===c&&e===0)||(h.Username===c&&e>0&&e!==h.ID)){a=true;}});if($.trim(c)===""||a===true){$(f).removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);
return false;}else{$(f).removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);return true;}}function validateEmail(b,c){var a=(b instanceof $)?b.val():$(b).val();
if(/^[\-!#$%&'*+\\.\/0-9=?A-Z\^_`a-z{|}~]+@[\-!#$%&'*+\\\/0-9=?A-Z\^_`a-z{|}~]+\.[\-!#$%&'*+\\.\/0-9=?A-Z\^_`a-z{|}~]+$/i.test(a)){$(c).removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);
return true;}else{$(c).removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);return false;}}function validatePassword(c,a,d){var b=(c instanceof $)?c.val():$(c).val();
if($.trim(b)===""||b!==a){$(d).removeClass("TickSmall").addClass("CrossSmall").fadeIn(250);return false;}else{$(d).removeClass("CrossSmall").addClass("TickSmall").fadeIn(250);
return true;}}function saveAccount(){var c=service+"?Operators",h=$.jStorage.get("accounts",[]),b=lastUpdatedAccount(h),f=($("#AccountStatusEnable").is(":checked"))?0:-1,g={Session:session,ID:$("#AccountID").val(),User:$("#AccountUsername").val(),Firstname:$("#AccountFirstname").val(),Lastname:$("#AccountLastname").val(),Email:$("#AccountEmail").val(),Department:$("#AccountDepartment").val(),Privilege:$("#AccountAccessLevel").val(),NewPassword:$("#AccountPassword").val(),Disabled:f,Cached:new Date.parse(b).toString("yyyy-MM-dd HH:mm:ss"),Format:"json",Version:"4.0"};
validateAccount(false);if($("#account-details").find(".InputError.CrossSmall").length>0){return;}var d=$(".account-dialog");d.find(".progressring").show();
d.find(".title").text("Saving Account");d.find(".description").text("One moment while your account is saved.");d.animate({bottom:0},250,"easeInOutBack");
function e(){d.find(".progressring").hide();d.find(".title").text("Error Saving Account");d.find(".description").text("An error occurred while saving your account.  Please contact technical support.");
d.delay(2000).animate({bottom:-90},250,"easeInOutBack");}function a(m){if(m.Operators!==null&&m.Operators!==undefined&&m.Operators.Operator!==undefined){var k=m.Operators.Operator;
$.jStorage.set("accounts",k);$(document).trigger("LiveHelp.AccountsUpdated",[k]);var j=false;$.each(h,function(o,q){var n=parseInt(q.ID,10),p=false;$.each(k,function(s,t){var r=parseInt(t.ID,10);
if(n===r){p=true;}});if(!p){j=true;}});var l=lastUpdatedAccount(k);if(l>b||j){updateAccountsGrid(k);}$.each(k,function(n,o){if(o.ID===g.ID){showAccount(o);
return;}});closeAccountDetails();d.animate({bottom:-90},250,"easeInOutBack");}else{e();}}if(accountFiles!==undefined){$("#account-upload").fileupload("send",{formData:g,files:accountFiles}).success(function(k,l,j){a(k);
if(parseInt(g.ID,10)===operator.id){$(".operators .image.photo").css({"background-image":"url(../image.php?ID="+operator.id+"&SIZE=40&"+$.now()+")"});$(".accounts-grid .photo").css({"background-image":"url(../image.php?ID="+operator.id+"&SIZE=50&"+$.now()+")"});
}$('#account-details .cell-inner[data-id="'+g.ID+'"] img').attr("src","../image.php?ID="+g.ID+"&SIZE=60&"+$.now());}).error(function(j,l,k){e();});accountFiles=undefined;
}else{$.ajax({url:c,data:g,type:"POST",success:function(j){a(j);},dataType:"json"});}}function showAddAccount(){$(".accounts-grid").fadeOut();var c=$("#account-details"),b=c.find(".button-toolbar.save"),a=b.height(),d=c.find(".button-toolbar.edit, .button-toolbar.add");
c.find(".header").text("Add Account");c.find(".back").fadeIn();c.find(".details").css("bottom","25px");c.find(".value").hide();c.find(":input, select, .password").val("").fadeIn();
c.find(".scroll, .button-toolbar.save, .LiveHelpInput, #account-upload, .upload, #account-dropzone").fadeIn();c.find("#AccountStatusEnable").attr("checked","checked");
c.find(".InputError").removeClass("TickSmall CrossSmall");d.css("bottom",-a+"px").hide();b.fadeIn().animate({bottom:"15px"},250,"easeInOutBack");}function validateAccount(c){var e=$("#account-details"),f=e.find(':input[id!="AccountUsername"][id!="AccountEmail"][id!="AccountPasswordConfirm"], select, .password');
if(!c){f=e.find(':input[id!="AccountUsername"][id!="AccountEmail"][id!="AccountPasswordConfirm"][id!="AccountPassword"], select');}$.each(f,function(h,j){var k=$(j).attr("id");
validateField($(j),"#"+k+"Error");});var d=$(':input[id="AccountUsername"]'),g=d.attr("id");validateUsername(d,"#"+g+"Error");d=$(':input[id="AccountEmail"]');
g=d.attr("id");validateEmail(d,"#"+g+"Error");var a=$("#AccountPassword"),b=$("#AccountPasswordConfirm");if(!c){if(a.val().length===0&&b.val().length===0){return;
}}g=b.attr("id");validatePassword(b,a.val(),"#"+g+"Error");}function updateAccountImage(b){var a=$("#account-upload");a.find(".image").css({background:"url("+b+") no-repeat",opacity:1,width:"100px",height:"100px",padding:0});
a.css({border:"none","border-radius":0,background:"transparent"}).fadeIn();$(".upload").hide();}var accountFiles;function addAccount(){var f=$("#account-details"),d=f.find("#AccountStatusEnable").is(":checked")?0:-1,b={Session:session,User:f.find("#AccountUsername").val(),Firstname:f.find("#AccountFirstname").val(),Lastname:f.find("#AccountLastname").val(),Email:f.find("#AccountEmail").val(),Department:f.find("#AccountDepartment").val(),NewPassword:f.find("#AccountPassword").val(),Privilege:f.find("#AccountAccessLevel").val(),Disabled:d,Format:"json",Version:"4.0"};
validateAccount(true);if(f.find(".InputError.CrossSmall").length>0){return;}var a=$(".account-dialog");a.find(".progressring").show();a.find(".title").text("Adding Account");
a.find(".description").text("One moment while you account is created.");a.animate({bottom:0},250,"easeInOutBack");function e(h){if(h.Operators!==undefined&&h.Operators.Operator!==undefined){var g=h.Operators.Operator;
showAccountsGrid(g);showAccounts();var j=0;$.each(g,function(k,l){if(l.Username===b.User){j=parseInt(l.ID,10);return false;}});if(j>0){$('#account-details .cell-inner[data-id="'+j+'"] img').attr("src","../image.php?ID="+j+"&SIZE=60&"+$.now());
}}a.animate({bottom:-90},250,"easeInOutBack");}function c(){a.find(".progressring").hide();a.find(".title").text("Error Adding Account");a.find(".description").text("An error occurred while adding your account.  Please contact technical support.");
}if(accountFiles!==undefined){$("#account-upload").fileupload("send",{formData:b,files:accountFiles}).success(function(h,j,g){e(h);}).error(function(g,j,h){c();
});accountFiles=undefined;}else{$.ajax({url:service+"?Operators",data:b,type:"POST",success:function(g){e(g);},error:function(g,j,h){c();},dataType:"json"});
}}function deleteAccount(){var a=service+"?Operators",d={Session:session,ID:$("#AccountID").val(),Format:"json",Version:"4.0"};var b=$(".confirm-delete");
function c(){b.find(".progressring").hide();b.find(".title").text("Error Deleting Account");b.find(".description").text("An error occurred while deleting your account.  Please contact technical support.");
b.delay(2000).animate({bottom:-90},250,"easeInOutBack");}function e(g){if(g.Operators!==null&&g.Operators!==undefined&&g.Operators.Operator!==undefined){var f=g.Operators.Operator;
showAccountsGrid(f);showAccounts();b.delay(2000).animate({bottom:-90},250,"easeInOutBack");}else{c();}}$.ajax({url:service+"?Operators",data:d,type:"POST",success:function(f){e(f);
},error:function(f,h,g){c();},dataType:"json"});}function refreshAccounts(a){switch(a){case"Online":a=1;break;case"BRB":a=2;break;case"Away":a=3;break;
default:a=0;break;}$.each(accounts.Operator,function(b,c){if(operator.id===parseInt(c.ID,10)){c.Status=a;}});}function showAccount(d){$(".accounts-grid").fadeOut();
var e=$("#account-details .details .btn-group"),c="Offline";if(operator.access>=2){e.hide();}else{e.css("display","inline-block");}d.status=parseInt(d.Status,10);
switch(d.status){case 1:c="Online";break;case 2:c="Be Right Back";break;case 3:c="Away";break;}e.find(".status").text(c);if(d.status!==1){e.find(".btn").addClass("disabled");
}else{e.find(".btn").removeClass("disabled");}e.find(".dropdown-menu.statusmode li a").on("click",function(){var n=$(".account-dialog");n.find(".progressring").show();
n.find(".title").text("Updating Operator Status Mode");n.find(".description").text("One moment while the operator status mode is updated.");n.animate({bottom:0},250,"easeInOutBack");
var o=$("#account-details .details :input#AccountID").val(),m=m,l=$(this).attr("class");updateUsers(l,o,function(){refreshAccounts(l);l=(l==="BRB")?"Be Right Back":l;
$("#account-details .dropdown-toggle .status").text(l);n.delay(1000).animate({bottom:-90},250,"easeInOutBack");});});$.jStorage.set("account",d);var f=$("#account-details");
f.find(".header").text(d.Firstname+" "+d.Lastname);f.find(".back").fadeIn();updateAccountImage("../image.php?ID="+d.ID+"&SIZE=100");f.find(":input#AccountID").val(d.ID);
f.find(".username.value").text(d.Username);f.find(":input#AccountUsername").val(d.Username);f.find(".firstname.value").text(d.Firstname);f.find(":input#AccountFirstname").val(d.Firstname);
f.find(".lastname.value").text(d.Lastname);f.find(":input#AccountLastname.").val(d.Lastname);f.find(".email.value").text(d.Email);f.find(":input#AccountEmail").val(d.Email);
f.find(".department.value").text(d.Department);f.find(":input#AccountDepartment").val(d.Department);var a=parseInt(d.Privilege,10);f.find("select#AccountAccessLevel").val(a);
a=convertAccessLevel(d.Privilege);f.find(".accesslevel.value").text(a);var b=parseInt(d.Disabled,10),g="Disabled";if(b===0){f.find("#AccountStatusEnable").attr("checked","checked");
g="Enabled";}else{f.find("#AccountStatusDisable").attr("checked","checked");g="Disabled";}f.find(".accountstatus.value").text(g);f.find(".details").css("bottom","25px");
f.find(".value").show();f.find(".LiveHelpInput, .password, .button-toolbar.save").hide();f.find(".scroll").fadeIn();var h=f.find(".button-toolbar.edit"),k=h.height(),j=f.find(".button-toolbar.add, .button-toolbar.save");
j.css("bottom",-k+"px").hide();h.fadeIn().animate({bottom:"15px"},250,"easeInOutBack");}function showAccounts(){var e=$("#account-details"),d=e.find(".button-toolbar"),f=e.find(".button-toolbar.add"),c=e.find(".confirm-delete"),b=e.find("#account-upload"),a=d.height();
e.find(".header").text("Add / Edit Accounts");e.find(".scroll").fadeOut();e.find("#account-image, .upload, #account-dropzone").fadeOut();e.find(".back").fadeOut();
e.find(".details").css("bottom",0);b.hide().find(".image").css({background:"url(../image.php?SIZE=60) no-repeat",opacity:0.5,width:"60px",height:"60px",padding:"20px"});
b.css({border:"2px dashed #CCC","border-radius":"20px",background:"#fafafa"});d.fadeOut().css("bottom",-a+"px");if(operator.access>=2){f.fadeOut();}else{f.fadeIn().animate({bottom:"15px"},250,"easeInOutBack");
}c.animate({bottom:"-90px"},250,"easeInOutBack");$(".accounts-grid").fadeIn();$("#account-details .details .btn-group").hide();if(e.is(":visible")){$.jStorage.set("account",null);
initAccountsGrid(true);}}function openAccounts(){var a=$("#account-details"),b=a.find(".button-toolbar.add");if(operator.access>=2){b.hide();}a.show();
a.css("z-index",sliderIndex()+100);a.animate({width:"40%",opacity:1},250,function(){var c=$.jStorage.get("account",null),d=$.jStorage.get("accounts",[]);
if(c!==null){$.each(d,function(e,f){if(c.ID===f.ID){c=f;}});showAccount(c);return;}initAccountsGrid(true);});}function closeAccount(){var b=$("#account-details"),a=b.width();
b.animate({width:0,opacity:0},250,function(){b.hide();});switchPreviousMenu();}var notifications=[];function updateUser(l,c){var h="",m=false,o=false.hash="",f=encodeURIComponent(window.location.protocol+"//"+window.location.host+window.location.pathname.replace("/livehelp/admin/","/livehelp/images/UserSmall.png")),a=$(".chatting.list"),j=$(".other-chatting.list"),b=$(".pending.list"),e=$(".operators.list"),g=null,n=0,k=false,d=$("#chatstotal");
if(l==="Online"){g=j;updateTotal(d,c.length);}else{if(l==="Pending"||l==="Transferred"){g=b;k=true;}else{if(l==="Staff"){g=e;o=true;}}}if(g!==null){if(c.length>0){$.each(c,function(B,z){h="";
if(l==="Online"){if(parseInt(z.Active,10)===operator.id){g=a;}else{g=j;}}hash=CryptoJS.MD5(z.Email);m=false;$.each(g.find(".visitor"),function(K,L){var C=parseInt(z.ID,10);
if(C===$(L).data("id")){m=true;if(l==="Online"){var F=parseInt(z.Messages,10),D=$(L).data("messages"),G=F-D,J=$(".chat-stack"),I=J.position().top,H=J.find(".chat[data-id="+C+"]").length,E=(I<0||H===0)?false:true;
if(G>0&&!E){$(L).find(".message-alert").text(G).fadeIn();}}return;}});if(!m){if(o){var r=$.jStorage.get("accounts",[]),p=z.Name,x="",t="",y="",w=parseInt(z.Status,10);
$.each(r,function(C,D){if(parseInt(D.ID,10)===parseInt(z.ID,10)){p=D.Firstname;x=D.Department;t=convertAccessLevel(D.Privilege);return;}});if(parseInt(z.ID,10)===operator.id){y=" photo";
}if(w===1){h='<div class="visitor" data-id="'+z.ID+'" data-messages="0"><span class="image'+y+'" style="background-image:url(\'../image.php?ID='+z.ID+'&SIZE=40\')"></span><span class="details name">'+p+'</span><span class="details department">'+x+'</span><span class="details accesslevel">'+t+'</span><span class="message-alert red" style="display:none">0</span></div>';
}}else{var v=parseInt(z.Messages,10),p=ucwords(z.Name.toLowerCase()),q=parseInt(z.ID,10);h='<div class="visitor" data-id="'+q+'" data-messages="'+v+'"><span class="image" style="background-image:url(\'https://secure.gravatar.com/avatar/'+hash+"?s=40&r=g&d="+f+'\')"></span><span class="details name">'+p+'</span><span class="details department">'+z.Department+'</span><span class="details accesslevel">'+z.Server+'</span><span class="message-alert red" style="display:none">0</span></div>';
var A=$.jStorage.get("html5-notifications",false);m=false;$.each(notifications,function(C,D){if(D.id===q){m=true;return false;}});if(l==="Pending"||l==="Transferred"){if(!m&&A&&window.webkitNotifications.checkPermission()===0){var s=window.webkitNotifications.createNotification("images/Icon.png",l+" Chat Request",p+" is waiting for Live Chat ("+z.Department+")");
s.show();notifications.push({id:q,section:l,notification:s});}}else{if(l==="Online"){$.each(notifications,function(C,D){if(D.id===q){D.notification.cancel();
return false;}});}}}if(k&&pendingSound!==undefined){pendingSound.play();}}if(h.length>0){g.find(".no-visitor").hide();var u=$(h).appendTo(g);$(u).data("user",z);
}});n=g.find(".visitor").length*74;if(n>0){g.data("height",n);if(g.height()>0){g.animate({height:n},250,"easeOutBack");}}n=a.find(".visitor").length*74;
if(n>0){a.data("height",n);if(a.height()>0){a.animate({height:n},250,"easeOutBack");}}}else{if(l!="Pending"&&l!="Transferred"){clearUsers(g);if(l==="Online"){clearUsers(a);
}}if(l==="Pending"||l==="Transferred"){$.each(notifications,function(p,q){if(q.section===l){q.notification.cancel();}});}}}}function clearUsers(a){a.find(".visitor").remove();
a.find(".no-visitor").show();a.height(38);a.data("height",38);}function removeVisitor(b,a){a.remove();height=b.find(".visitor").length*74;if(height>0){if(b.height()>0){b.animate({height:height},250,"easeOutBack");
}b.data("height",height);}}var users={},usersTimer;function updateUsers(c,d,a){if(session.length>0){var b=service+"?Users";post={Session:session,Version:"4.0",Format:"json"};
if(c!==undefined){$.extend(post,{Action:c});}if(d!==undefined){$.extend(post,{ID:d});}window.clearTimeout(usersTimer);$.ajax({url:b,data:post,type:"POST",success:function(e){updateUsersInterface(e,c,d);
if(a){a();}},dataType:"json",error:function(e,g,f){usersTimer=window.setTimeout(updateUsers,10000);}});}}function updateUsersInterface(g,d,b){if(g.Users!==undefined){users=g.Users;
var f=$(".operators .visitor"),a=$(".chatting .visitor, .other-chatting .visitor"),c=$(".pending .visitor"),h=$(".operators.list"),e=b;var j=0;$.each(f,function(m,o){var l=$(o),p=l.data("id"),n=false;
$.each(users.Staff.User,function(q,r){if(parseInt(r.ID,10)===p&&parseInt(r.Status,10)===1){n=true;j++;}});if(!n){removeVisitor(h,l);}});if(j===0){clearUsers(h);
}$.each(users.Online.User,function(l,m){if(d==="Accept"&&e===parseInt(m.ID,10)&&parseInt(m.Active,10)===operator.id){openChat(b,m);}});h=$(".chatting.list");
if(a.length>0){var k=0;$.each(a,function(m,o){var l=$(o),p=l.data("id"),n=false;$.each(users.Online.User,function(q,r){if(parseInt(r.ID,10)===p){n=true;
}if(parseInt(r.Active,10)===operator.id){k++;}});if(!n){removeVisitor(h,l);}});if(k===0){clearUsers(h);}}else{clearUsers(h);}if(users.Pending.User.length>0){showPendingNotification(users.Pending.User);
}else{closeNotification();}h=$(".pending.list");if(c.length>0){$.each(c,function(m,p){var l=$(p),q=l.data("id"),o=false,n=users.Pending.User.length+users.Transferred.User.length;
$.each(users.Pending.User,function(r,s){if(parseInt(s.ID,10)===q){o=true;return false;}});$.each(users.Transferred.User,function(r,s){if(parseInt(s.ID,10)===q){o=true;
return false;}});if(!o){removeVisitor(h,l);}if(n===0){clearUsers(h);}});}else{clearUsers(h);}$.each(users,function(m,l){updateUser(m,l.User);});}usersTimer=window.setTimeout(updateUsers,10000);
}function convertAccessLevel(a){var b=parseInt(a,10);switch(b){case -1:case 0:a="Full Administrator";break;case 1:a="Department Administrator";break;case 2:a="Limited Administrator";
break;case 3:a="Sales / Support Staff";break;case 4:a="Guest";break;}return a;}function openChat(b,f){var m=$(".chat-stack"),q=m.find(".chat"),h='<div class="chat" style="left:0; bottom:0; background-color:#ffffff; z-index:500" data-id="'+b+'"><div class="name"></div><span class="message-alert red" data-total="0" style="bottom:10px; right:7px; top:auto; display:none">2</span><div class="inputs"><div class="close"></div><div class="title"><span style="background: url(../image.php?SIZE=50) #fff; width:50px; height:50px; float:left; margin:5px 10px; display:block"></span><span class="title"><span></div><div class="scroll"><div class="messages"></div><div class="end"></div></div></div></div>',n=false,e=false;
$.each(q,function(s,u){var r=$(u),t=r.data("id");if(t===b){n=true;}if(r.height()===0){e=true;}});if(!n){$.each(q,function(v,x){var s=$(x),u=s.css("z-index"),y=parseInt(s.css("left"),10),t=s.find(".name"),r=s.find(".inputs, input"),w=s.data("id");
if(v===0){s.css({bottom:2+"px","background-color":"#fafafa",left:y+35+"px"});}else{s.css({bottom:4+"px","background-color":"#f6f6f6",left:y+35+"px"});}s.css("z-index",u-10);
t.show();r.hide();});$(h).prependTo(m);}else{if(e){$.each(q,function(t,u){var s=$(u),v=parseInt(s.css("left"),10),r=s.height();if(r>0){if(v===0){s.find(".name").show();
s.find(".close, .inputs").hide();}s.animate({left:v+35},250);}else{s.css({height:"auto"});}});}}var o=$(document).height()-10,p=m.find(".chat[data-id="+b+"]"),a=ucwords(f.Name);
p.find(".name").text(a).hide();p.find(".inputs").show();p.find(".title").text(a+" - "+f.Email);p.data("closed",false);if(parseInt(m.css("top"),10)!==0){p.click();
m.animate({top:0,bottom:10,opacity:1,height:o},250,function(){$(this).css({height:"auto"});});}else{var c=parseInt(p.css("left"),10);if(c===0){var g=50,l="easeOutBack";
for(i=0;i<3;i++){p.animate({bottom:-5},g,l).delay(g).animate({bottom:0},g,l);}p.find("#message").focus();}else{p.click();}}$(".chat-stack .smilies.button").close();
checkBlocked(b);var j=$(".visitor[data-id="+b+"]"),k=j.find(".message-alert"),d=parseInt(j.data("messages"),10)+parseInt(k.text(),10);j.data("messages",d);
k.fadeOut();}function closeChats(){var b=$(".chat-stack"),a=b.height();$(".chat-stack .smilies.button").close();b.animate({top:-a,bottom:30+a},250);return false;
}function showPendingNotification(d){var c=$(".notification"),b="Pending Chat",a="";if(d.length>1){b="Pending Chats";a=d.length+" visitors are pending for Live Chat";
}else{if(d.length===1){a=d[0].Name+" is pending for Live Chat";}}c.off("click");c.on("click",function(){if(d.length===1){var f=parseInt(d[0].ID,10),e=$(".pending .visitor[data-id="+f+"]");
acceptChat(e);}});if(a.length>0){if(c.find(".icon").css("background-image").indexOf("ChatNotification.png")===-1){c.find(".icon").css({"background-image":"url(images/ChatNotification.png)",width:"36px",height:"26px"});
}c.find(".notify").text(b);c.find(".notify").text(a);showNotification();}}function showNotification(){$(".notification").animate({top:-20},250,"easeInOutBack");
}function closeNotification(){$(".notification").animate({top:-75},500,"easeInOutBack");}function sendMessage(d){var b=service+"?Send",a=$(".chat-stack textarea"),g=$(".chat-stack .chat"),f=0,e=(d!==undefined)?d:a.val(),c={Session:session,Message:e,Staff:0,Version:"4.0",Format:"json"};
$.each(g,function(h,j){if($(j).position().left===0){f=$(j).data("id");return;}});if(f>0){c.ID=f;$.ajax({url:b,data:c,type:"POST",success:function(h){},dataType:"json"});
a.val("");}return false;}function sendCommand(f,d,b,e){var a=service+"?Send",c="Session="+session+"&ID="+f;d=(d!==undefined)?"&Type="+d:"";b=(b!==undefined)?"&Name="+b:"";
e=(e!==undefined)?"&Content="+e:"";c+=d+b+e+"&Staff=0&Version=4.0&Format=json";$.ajax({url:a,data:c,type:"POST",success:function(g){},dataType:"json"});
return false;}function filterResponses(){var a=$("#responses input.#search").val(),d=a.split(" "),f=[],b=[],c=["Text","Hyperlink","Image","PUSH","JavaScript"];
$.each(responses,function(g,h){if($.inArray(g,c)>-1){$.each(h,function(k,j){var m=parseInt(j.ID,10),l=false;$.each(d,function(n,o){if(j.Name.toLowerCase().indexOf(o)>-1||j.Content.toLowerCase().indexOf(o)>-1){l=true;
return false;}});if(l){f.push(m);}else{b.push(m);}});}});if(responses.length===0){f.push(b);}var e=$("#responses .response");$.each(f,function(g,h){e.filter("[data-id="+h+"]").show();
});$.each(b,function(g,h){e.filter("[data-id="+h+"]").hide();});}function processEscKeyDown(){var c=$(".slider.right"),f=$("#visitor-details"),e=$("#account-details"),b=$("#settings"),d=$(".accounts-grid"),a=0,g=null;
if(b.is(":visible")&&b.width()>0){closeSettings();return;}$.each(c,function(l,m){var k=$(m),j=parseInt(k.css("z-index"),10);if(k.width()>0&&j>a){g=k;a=j;
}});if(g!==null){var h=g.attr("id");switch(h){case"responses":closeResponses();break;case"visitor-details":closeVisitor();break;case"account-details":if(d.is(":visible")===false){showAccounts();
}if(e.is(":visible")&&e.width()>0){closeAccount();}break;case"history-chat":closeHistory();break;}return;}if(parseInt($(".chat-stack").css("top"),10)===0){closeChats();
return;}}var responses={},tags=[];function updateResponses(c){var b=$("#responses .scroll #response-list"),a=["Text","Hyperlink","Image","PUSH","JavaScript"],d={};
$(".chat-stack .options.dropdown-menu > li").filter(".text, .hyperlink, .image, .push, .javascript").find("> .dropdown-menu").remove();b.html("");$.each(c,function(e,f){if($.inArray(e,a)>-1){var g=(e==="PUSH"||e==="Hyperlink")?'<span style="position: absolute; right: 40px">'+e+"</span>":"";
e=e.toLowerCase();$('<div class="'+e+'" />').appendTo(b);if(d[e]===undefined){d[e]=$("#response-list ."+e);}var h=$(".chat-stack .options.dropdown-menu ."+e);
if(f.length>0&&h.find("ul").length===0){h.addClass("dropdown-submenu");$('<ul class="dropdown-menu"></ul>').appendTo(h);}h=h.find(".dropdown-menu");$.each(f,function(r,m){var l=parseInt(m.ID,10),s="",o="display: none",p=m.Content,j=$('<li class="responseitem submenu"><a href="#">'+m.Name+"</a></li>");
j.data("response",m);if(m.Category.length>0){var n=h.find("li."+e+".category a"),q=false;$.each(n,function(t,v){var u=$(v);if(u.text()===m.Category){q=u;
return;}});if(!q){var k=$('<li class="'+e+' category dropdown-submenu"><a href="#">'+m.Category+'</a><ul class="dropdown-menu"></ul></li>');j.appendTo(k.find(".dropdown-menu"));
k.appendTo(h);}else{j.appendTo(q.parent().find("ul.dropdown-menu"));}}else{j.appendTo(h);}if(m.Tags!==undefined){if(m.Tags.length>0){$.each(m.Tags,function(u,t){t=t.toLowerCase();
if($.inArray(t,tags)===-1){tags.push(t);}});o="display: inline-block";s=m.Tags.join(", ");}else{o="display: none";}}p=p.replace(/^(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|](\.jpg|.jpeg|\.gif|\.png)$/img,'<img src="$&" style="max-width: 300px"/>');
$('<div class="response" data-id="'+l+'"><div class="label">'+m.Name+g+'</div><div class="edit" title="Edit Response"></div><div class="content">'+p+'</div><div class="tags"><span class="tag-icon" style="'+o+'"></span><span class="tag">'+s+'</span></div><div class="send" title="Send Response"></div></div>').appendTo(d[e]);
});}});}function loadResponses(){if(session.length>0){var a=service+"?Responses",b="Session="+session+"&Version=4.0&Format=json";$.ajax({url:a,data:b,type:"POST",success:function(c){if(c!==undefined&&c.Responses!==undefined){responses=c.Responses;
updateResponses(responses);}$(".responseitem.submenu").on("click",function(){var d=$(this).data("response"),e="Text";switch(d.Type){case 2:e="Hyperlink";
break;case 3:e="Image";break;case 4:e="PUSH";break;case 5:e="JavaScript";break;}sendResponse(e,d);});},dataType:"json"});}}function updateTotal(a,b){var c=parseInt(a.text(),10);
height=a.css("line-height");if(b!==c){a.animate({height:0},350,function(){$(this).text(b).animate({height:height},350);});}}function toggleChatMenu(c,a){var b="expander sprite sort-desc",d=c.attr("id");
if(a>0){b="expander sprite sort-asc";}$.jStorage.set(d+".height",a);c.animate({height:a},250,"easeOutBack",function(){if(a>0){c.show();}else{c.hide();}$(this).prev().find(".expander").removeAttr("class").addClass(b);
});}function openHistory(){$(".visitors-grid, .visitors-empty, .statistics").fadeOut();$(".history").fadeIn(function(){if(historyChartData.length>0){showHistoryChart();
}});initHistoryGrid();}function openStatistics(){$(".visitors-grid, .visitors-empty, .history").fadeOut();$(".statistics").fadeIn(function(){if(ratingChartData.length>0){showRatingChart();
}if(weekdayChartData.length>0){showWeekdayChart();}});}var previousMenu="";function switchMenu(b){var a="",d=["home","statistics","history"];switch(b){case"home":openHome();
previousMenu=b;break;case"statistics":openStatistics();previousMenu=b;break;case"history":openHistory();previousMenu=b;break;case"responses":openResponses();
a=b;break;case"accounts":openAccounts();a=b;break;case"settings":openSettings();a=b;break;}if(a.length>0){$.jStorage.set("popout",a);}var c=$(".menu li a");
c.removeClass("selectedMenu");c.filter("[data-type="+b+"]").addClass("selectedMenu");}function switchPreviousMenu(){$.jStorage.set("popout","");if(previousMenu.length>0){var a=$(".menu li a");
a.removeClass("selectedMenu");a.filter("[data-type="+previousMenu+"]").addClass("selectedMenu");}}function loadLocalSettings(){var a=[{id:"operators",height:38},{id:"chatting",height:38},{id:"other-chatting",height:0},{id:"pending",height:38}];
$.each(a,function(e,f){var d=$.jStorage.get(f.id+".height",f.height),g=$("#"+f.id);toggleChatMenu(g,d);});var c=$.jStorage.get("menu","home");switchMenu(c);
var b=$.jStorage.get("popout");switch(b){case"responses":openResponses();break;case"accounts":openAccounts();break;case"settings":openSettings();break;
}}var session="",factor="",error=false;function signInComplete(){$(".login").fadeOut();$(".content").animate({opacity:1},250);if(messageSound===undefined){messageSound=new buzz.sound("/livehelp/sounds/New Message",{formats:["ogg","mp3","wav"],volume:100});
}if(pendingSound===undefined){pendingSound=new buzz.sound("/livehelp/sounds/Pending Chat",{formats:["ogg","mp3","wav"],volume:100});}operator=$.jStorage.get("operator");
if(operator!==undefined){$(".operator .photo").css("background-image","url(../image.php?ID="+operator.id+"&SIZE=50)");$(".operator .name").text(operator.name);
}$(".login").find(":input, select").val("");loadLocalSettings();updateUsers();updateVisitorsGrid();loadStatisticsChartData();initAccountsGrid(false);loadResponses();
var a=service+"?Settings",b={Session:session,Version:"4.0",Format:"json"};$.ajax({url:a,data:b,type:"POST",success:function(c){if(c.Settings!==undefined){loadSettings(c.Settings);
var d=$(".chat-stack .dropdown-menu.options");$(".chat-stack .dropdown-toggle.options").click(function(){var f=d.find(".EmailChatOffline");f.text("Offline Email Address ("+c.Settings.Email+")");
var h=$(".chat-stack .chat"),e=$(".chatting .visitor"),g=0;$.each(h,function(j,k){if($(k).position().left===0){g=$(k).data("id");return;}});f.data("id",g);
$.each(e,function(k,l){if($(l).data("id")===g){var j=$(".chatting .visitor").data("user").Email,m=d.find(".EmailChatVisitor");m.text("Visitor's Email Address ("+j+")").data("email",j);
m.data("id",g);return;}});});d.find(".Close").click(function(){closeChat();});d.find(".Block").click(function(){blockChat();});d.find(".EmailChatOffline").click(function(){emailChat($(this).data("id"),"");
});d.find(".EmailChatVisitor").click(function(){emailChat($(this).data("id"),$(this).data("email"));});}},dataType:"json"});}function closeChat(){var e=$(".chat-stack .chat"),a=[],b=null,d=0;
$.each(e,function(g,h){var f=$(h),j=f.position().left;if(j===0){d=f.data("id");b=h;return;}});if(b!==null){var c=$(".chat-stack .dialog");c.find(".progressring img").attr("src","images/ProgressRing.gif");
c.find(".dialog-title").text("Closing Chat Session");c.find(".dialog-description").text("One moment while the chat session is closed.");c.show().animate({bottom:"1px"},250);
updateUsers("Close",d,function(){c.animate({bottom:"-145px"},250,function(){$(this).hide();});if(e.length>1){$.each(e,function(h,j){var g=$(j),k=g.position().left,f=g.height();
if(k===0){g.animate({height:-f},250,function(){$(this).remove();});g.find(".inputs").hide();return;}else{if(k==35){g.find(".name").hide();g.find(".inputs").show();
}g.animate({left:k-35},250);}});}else{e.remove();closeChats();}e=[];$.each(activechats,function(f,g){if(g.id!==d){e.push(g);return;}});activechats=e;});
return;}}function blockChat(){var e=$(".chat-stack .chat"),a=[],b=null,d=0;$.each(e,function(g,h){var f=$(h),j=f.position().left;if(j===0){d=f.data("id");
b=h;return;}});if(b!==null){var c=$(".chat-stack .dialog");c.find(".progressring img").attr("src","images/ProgressRing.gif");c.find(".dialog-title").text("Blocking Chat Session");
c.find(".dialog-description").text("One moment while the chat session is blocked.");c.show().animate({bottom:"1px"},250);updateUsers("Block",d,function(){c.find(".progressring img").attr("src","images/Block.png");
c.find(".unblock").fadeIn();c.find(".dialog-title").text("Chat Session Blocked");c.find(".dialog-description").text("The chat session is blocked and inactive.");
var f=null,g=false,h=[];$.each(activechats,function(j,k){if(k.id===d){f=k;}else{h.push(k);}});activechats=h;$.each(blockedchats,function(j,k){if(k.id===d){g=true;
return;}});if(!g){if($.inArray(d,blockedchats)===-1){blockedchats.push(f);}}});}}function unblockChat(c,b){var a=[];b.find(".progressring img").attr("src","images/ProgressRing.gif");
b.find(".dialog-title").text("Unblocking Chat Session");b.find(".dialog-description").text("One moment while the chat session is unblocked.");updateUsers("Unblock",c,function(){b.find(".progressring img").fadeOut();
b.find(".dialog-title").text("Chat Session Unblocked");b.find(".dialog-description").text("The chat session is nunblocked and can now request Live Chat.");
b.animate({bottom:"1px"},250,function(){b.find(".unblock").hide();b.hide();});$.each(blockedchats,function(e,d){if(d.id===c){exists=true;return;}else{a.push(d);
}});blockedchats=a;});}function emailChat(d,b){var a=service+"?EmailChat",c={Session:session,ID:d,Email:b,Version:"4.0",Format:"json"};$.ajax({url:a,data:c,type:"POST",success:function(e){},dataType:"json"});
}function signInError(){var a=$(".login .inputs");a.find(".error").fadeIn();a.effect("shake",{times:3,distance:10},150);error=true;}function signIn(){if(session.length>0&&factor.length>0){twofactorAuth();
return;}var c=$(".login"),h=c.find(":input#server").val(),d=(h.length>0)?"http://"+h+"/livehelp/xml/WebService.php?Login":service+"?Login",b=c.find(":input#username").val(),g=c.find(":input#password").val(),a=c.find("select#status").val(),e={Version:"4.0",Format:"json"};
if(b.length>0&&g.length>0){$.extend(e,{Username:b,Password:g,Action:a});}else{var f=$.jStorage.get("session","");if(f.length>0){$.extend(e,{Session:f});
}}$.ajax({url:d,data:e,type:"POST",success:function(o){if(o.Login!==undefined){if(o.factors!==undefined){var p=o.factors,n=$(".twofactor"),l=$(".twofactorcode"),m={push:false,token:true,sms:false,telephone:false},j=220;
session=o.Login.Session;$.each(p,function(r,s){var q=s.factor;if(q.indexOf("push")!==-1){m.push=true;}else{if(q.indexOf("token")!==-1){m.token=true;}else{if(q.indexOf("sms")!==-1){m.sms=true;
l.find(".hint-sms").text(s.details);}else{if(q.indexOf("telephone")!==-1){m.telephone=true;}}}}});$.each(m,function(r,q){if(!q){n.find(".factor[data-factor="+r+"]").hide();
}});if(error){j=j-25;}c.find(".btn-toolbar .signin").text("Authenticate");c.find(".inputs").animate({height:$(".login .inputs").height()+j},250);c.find(".inputs .error").fadeOut();
$(".twofactorparent").fadeIn();}else{if(o.Login.Session.length>0){session=o.Login.Session;operator={id:o.Login.ID,username:b,name:o.Login.Name,access:parseInt(o.Login.Access,10)};
$.jStorage.set("session",session);$.jStorage.set("operator",operator);signInComplete();var k="Offline (Hidden)";switch(o.Login.Status){case 1:k="Online";
break;case 2:k="BRB";break;case 3:k="Away";break;}k=(k==="BRB")?"Be Right Back":k;$(".operator .status").text(k);}}}},error:function(){signInError();},dataType:"json"});
}function signOut(){session="";$.jStorage.set("session","");$.jStorage.set("accounts","");$.jStorage.set("operator","");document.location.href="index.html";
$(".loading").hide();$(".content").animate({opacity:0},250);$(".login").fadeIn();}function twoFactorError(){var a=$(".login .inputs"),b=$(".twofactorcode");
a.effect("shake",{times:3,distance:10},150);b.find(".status").hide();b.find(".code").fadeIn();}function twofactorAuth(){var a="./duo/index.php",e=$(".twofactorcode"),d=e.find(":input#twofactor"),c=d.val(),b="";
if(session.length>0){b="session="+session;}else{return;}if(factor.length>0){b+="&factor="+factor;if(factor==="token"||factor==="sms"){e.find(".code").fadeOut(function(){e.find(".status span").text("Authenticating...");
e.find(".status").fadeIn();});}}d.val("");if(c.length>0){b+="&code="+c;}e.find(".status img").animate({opacity:0.5},250);$.ajax({url:a,data:b,type:"POST",success:function(h){var g=$(".twofactorcode"),f=g.find(".status");
if(h.result!==undefined){f.find("img").animate({opacity:0},250);g.find(".code label").text(h.status);if(h.result=="allow"){twoFactorComplete();}else{twoFactorError();
}return;}if(h.session.length>0){session=h.session;window.setTimeout(twofactorStatus,2000);}},dataType:"json"});}function twofactorStatus(){var a="./duo/index.php",b="";
if(session.length>0){b="session="+session;}else{return;}$.ajax({url:a,data:b,type:"POST",success:function(d){var c=$(".twofactorcode .status");if(d.result!==undefined){c.find("img").animate({opacity:0},250);
c.find("label").text(d.status);if(d.result==="allow"){twoFactorComplete();}else{twoFactorError();}}else{window.setTimeout(twofactorStatus,2000);}c.find("label").text(d.status);
},dataType:"json"});}function twoFactorComplete(){$(".login").fadeOut();$(".content").animate({opacity:1},250);}var messageSound,pendingSound;function convertHostname(b){var a=b.Hostname,c=ucwords(b.Username);
if(c!==null&&c.length>0){a=c+" - "+a;}return a;}function convertBrowserIcon(c,b){var a="Chrome",d="";if(c.indexOf("MSIE")!==-1){a="InternetExplorer";}else{if(c.indexOf("Chrome")!==-1){a="Chrome";
}else{if(c.indexOf("Opera")!==-1){a="Opera";}else{if(c.indexOf("Safari")!==-1){a="Safari";}else{if(c.indexOf("Firefox")!==-1){a="Firefox";}}}}}if(b){d="./images/"+a+"Small.png";
}else{d="./images/"+a+".png";}return d;}function convertReferrer(b){var c=/^http[s]{0,1}:\/\/(?:[^.]+[\\.])*google(?:(?:.[a-z]{2,3}){1,2})[\/](?:search|url|imgres)(?:\?|.*&)q=([^&]*)/i;
var a=c.exec(b);if(a!==null){if(a[1].length>0){b="Google Search (Keywords: "+a[1]+")";}else{b="Google Search";}}return b;}function convertCountryIcon(c){var b={"Ascension Island":"ac",Andorra:"ad","United Arab Emirates":"ae",Afghanistan:"af","Antigua And Barbuda":"ag",Anguilla:"ai",Albania:"al",Armenia:"am","Netherlands Antilles":"an",Angola:"ao",Antarctica:"aq",Argentina:"ar","American Samoa":"as",Austria:"at",Australia:"au",Aruba:"aw","Aland Islands":"ax",Azerbaijan:"az","Bosnia And Herzegovina":"ba",Barbados:"bb",Bangladesh:"bd",Belgium:"be","Burkina Faso":"bf",Bulgaria:"bg",Bahrain:"bh",Burundi:"bi",Benin:"bj",Bermuda:"bm","Brunei Darussalam":"bn",Bolivia:"bo",Brazil:"br",Bahamas:"bs",Bhutan:"bt","Bouvet Island":"bv",Botswana:"bw",Belarus:"by",Belize:"bz",Canada:"ca","Cocos (keeling) Islands":"cc","Congo, The Democratic Republic of The":"cd","Central African Republic":"cf","Congo, Republic of The":"cg",Switzerland:"ch","Cote D'ivoire":"ci","Cook Islands":"ck",Chile:"cl",Cameroon:"cm",China:"cn",Colombia:"co","Costa Rica":"cr",Cuba:"cu","Cape Verde":"cv","Christmas Island":"cx",Cyprus:"cy","Czech Republic":"cz",Germany:"de",Djibouti:"dj",Denmark:"dk",Dominica:"dm","Dominican Republic":"do",Algeria:"dz",Ecuador:"ec",Estonia:"ee",Egypt:"eg","Western Sahara":"eh",Eritrea:"er",Spain:"es",Ethiopia:"et",Finland:"fi",Fiji:"fj","Falkland Islands ( Malvinas )":"fk","Micronesia, Federated States of":"fm","Faroe Islands":"fo",France:"fr",Gabon:"ga",Grenada:"gd",Georgia:"ge","French Guiana":"gf",Ghana:"gh",Gibraltar:"gi",Greenland:"gl",Gambia:"gm",Guinea:"gn",Guadeloupe:"gp","Equatorial Guinea":"gq",Greece:"gr","South Georgia And The South Sandwich Islands":"gs",Guatemala:"gt",Guam:"gu","Guinea-bissau":"gw",Guyana:"gy","Hong Kong":"hk","Heard Island And Mcdonald Islands":"hm",Honduras:"hn",Croatia:"hr",Haiti:"ht",Hungary:"hu",Indonesia:"id","Ireland, Republic of":"ie",Ireland:"ie",Israel:"il",India:"in","British Indian Ocean Territory":"io",Iraq:"iq","Iran, Islamic Republic of":"ir",Iceland:"is",Italy:"it",Jamaica:"jm",Jordan:"jo",Japan:"jp",Kenya:"ke",Kyrgyzstan:"kg",Cambodia:"kh",Kiribati:"ki",Comoros:"km","Saint Kitts And Nevis":"kn","Korea, Democratic People's Republic of":"kp","Korea, Republic of":"kr",Kuwait:"kw","Cayman Islands":"ky",Kazakhstan:"kz","Lao People's Democratic Republic":"la",Lebanon:"lb","Saint Lucia":"lc",Liechtenstein:"li","Sri Lanka":"lk",Liberia:"lr",Lesotho:"ls",Lithuania:"lt",Luxembourg:"lu",Latvia:"lv","Libyan Arab Jamahiriya":"ly",Morocco:"ma",Monaco:"mc","Moldova, Republic of":"md","Montenegro, Republic of":"me",Madagascar:"mg","Marshall Islands":"mh","Macedonia, Republic of":"mk",Mali:"ml",Myanmar:"mm",Mongolia:"mn",Macau:"mo","Northern Mariana Islands":"mp",Martinique:"mq",Mauritania:"mr",Montserrat:"ms",Malta:"mt",Mauritius:"mu",Maldives:"mv",Malawi:"mw",Mexico:"mx",Malaysia:"my",Mozambique:"mz",Namibia:"na","New Caledonia":"nc",Niger:"ne","Norfolk Island":"nf",Nigeria:"ng",Nicaragua:"ni",Netherlands:"nl",Norway:"no",Nepal:"np",Nauru:"nr",Niue:"nu","New Zealand":"nz",Oman:"om",Panama:"pa",Peru:"pe","French Polynesia":"pf","Papua New Guinea":"pg",Philippines:"ph",Pakistan:"pk",Poland:"pl","Saint Pierre And Miquelon":"pm",Pitcairn:"pn","Puerto Rico":"pr","Palestinian Territory, Occupied":"ps","Palestinian Territory":"ps",Portugal:"pt",Palau:"pw",Paraguay:"py",Qatar:"qa",Reunion:"re",Romania:"ro",Serbia:"rs","Serbia, Republic of":"rs","Russian Federation":"ru",Rwanda:"rw","Saudi Arabia":"sa","Solomon Islands":"sb",Seychelles:"sc",Sudan:"sd",Sweden:"se",Singapore:"sg","Saint Helena":"sh",Slovenia:"si","Svalbard And Jan Mayen":"sj",Slovakia:"sk","Sierra Leone":"sl","San Marino":"sm",Senegal:"sn",Somalia:"so",Suriname:"sr","Sao Tome And Principe":"st","El Salvador":"sv","Syrian Arab Republic":"sy",Swaziland:"sz","Turks And Caicos Islands":"tc",Chad:"td","French Southern Territories":"tf",Togo:"tg",Thailand:"th",Tajikistan:"tj",Tokelau:"tk","Timor - Leste ( East Timor )":"tl",Turkmenistan:"tm",Tunisia:"tn",Tonga:"to",Turkey:"tr","Trinidad And Tobago":"tt",Tuvalu:"tv",Taiwan:"tw","Taiwan, Province of China":"tw","Tanzania, United Republic of":"tz",Ukraine:"ua",Uganda:"ug","United Kingdom":"uk","United States Minor Outlying Islands":"um","United States":"us",Uruguay:"uy",Uzbekistan:"uz","Holy See ( Atican City State )":"va","Saint Vincent And The Grenadines":"vc",Venezuela:"ve","Virgin Islands, British":"vg","Virgin Islands, United States":"vi",Vietnam:"vn",Vanuatu:"vu","Wallis And Futuna":"wf",Samoa:"ws",Yemen:"ye",Mayotte:"yt","South Africa":"za",Zambia:"zm",Zimbabwe:"zw"},d=b[c],a=c;
if(d===undefined||d==="Unavailable"){a="";}else{if(d!==undefined){a="sprite "+d;}}return a;}function convertCountry(b){var a=b.Country;if(b.State.length>0){if(b.City.length>0){a=b.City+", "+b.State+", "+b.Country;
}else{a=b.State+", "+b.Country;}}else{if(b.City.length>0){a=b.City+", "+b.Country;}}return a;}